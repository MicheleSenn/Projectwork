---
title: Scare-off measures against wild boars 
subtitle: computational movement analysis
author: Lia Baumann and Michele Senn
output: html_document

---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r load wild boar data, include=FALSE}
#install.packages("backports"); install.packages("devtools")
#install.packages("cli")
#update.packages(cli)
#install.packages("devtools") # <- if you havent installed devtools already
library(devtools)
devtools::install_github("ComputationalMovementAnalysis/ComputationalMovementAnalysisData")
library(ComputationalMovementAnalysisData)
head(wildschwein_BE)
summary(wildschwein_BE)
head(schreck_agenda)
summary(schreck_agenda)
head(schreck_locations)
head(wildschwein_metadata)
head(wildschwein_overlap_temp)
```

## Abstract

<!-- the following is just a placeholder text, remove it!-->
This project aims at modelling the behavior of wild boars after scare-off measures. It is hypothesized that they will return within a few days back to the scare-off location and this returning pattern will be analysed.


## Research Question

<!-- the following is just a placeholder text, remove it!-->
Once a scare-off measure has proven to have an effect and cause the wild boars to relocate, it needs to be examined how long the effect lasts. Therefore, the following research question was formulated:

How can the returning of the boars be modelled?

##Data

Long-term data for movement trajectories will be necessary (at least 6 weeks).
Data should be of different times of day and of several individuals in a similar location.
Furthermore, mapdata will be needed.
Some background information on the boars social behavior and seasonal movements would also be interesting and help for a better understanding of the data.

##Analytical concepts

EDA: plotting data in order to get an idea of what the data looks like and finding patterns like which individual is Schrecked by what
Calculating distances to Scare-Off-Location over time using the ST_Distance() function, which returns the shortest distance that separates two geometries
Trajectories with Moving Window Method to remove static points
Plot spatial and time overlaps between the tracked animals
Find returning patterns by building a "In the Field / not in the Field" vs. distance to Schreck graph

##R concepts

The modeling will be done using the following concepts and packages:

Spatial objects will be created with the r-package "sf"
raster data and background maps will be plotted and visuallized with these r-packages: "plotly", "ggplot2"
For the reshaping and transforming of date the r-package "tidyverse" will be used

##Risk analysis

We consider the scope a bit of a risk because of the amount of behaviors we could potentially analyse --> we need to be clear on what we really want to find out and stick to it.
Interpretation of behaviors might be vague or non-causal because we assume that patterns can be detected when nothing is happening at all in reality (--> semantic annotations)
Surprisingly, no differences between seasons / locations / individuals detected --> we can still focus on time series analysis
Technical difficulties, e.g. when handling too much data, choosing irrelevant thresholds or interpretation issues.
Possibly, the different measures don't show the same effects. We might need to distinguish between measures in order to draw inferences.

## Results

```{r packages, include=FALSE}
library(ComputationalMovementAnalysisData)
library(ggplot2)
library(dplyr)
library(sf)

# Include tables with the function "kable"

#knitr::kable(head(wildschwein_BE))
```
```{r temporal overlap, eval=FALSE, include=FALSE}
sampling_periods <- wildschwein_BE %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise(
    min = min(DatetimeUTC),
    max = max(DatetimeUTC)
  )


wildschwein_overlap_temp <- wildschwein_overlap_temp %>%
  left_join(sampling_periods, by = c("TierID", "TierName", "CollarID"))


wildschwein_overlap_temp %>%
mutate(TierCollar = paste(TierName, CollarID)) %>%
  ggplot(aes(xmin = min, xmax = max, y = TierCollar)) +
  geom_errorbarh() +
  facet_grid(Groups~., scales = "free_y", space = "free_y")

```
```{r spatial overlap, include=FALSE}
wildschwein_sf <- wildschwein_BE %>%
  st_as_sf(coords = c("E", "N"), crs = 2056) %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) 

wildschwein_convex_hull <- wildschwein_sf %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise() %>%
  st_convex_hull()


wildschwein_convex_hull %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) %>%
  ggplot(aes(fill = factor(TierID))) + geom_sf(alpha = 0.1) +
  coord_sf(datum = 2056) +
  facet_wrap(~tiercollar) +
  theme(legend.position = "none")


st_overlaps(wildschwein_convex_hull, sparse = FALSE)[1:5, 1:5]
```

#Data Preparation
To find out, which boars were affected by which Schreck, the datasets were both transformed into the same coordinate system using st_transform(2056). They were subsequently plotted on top of each other to visualize the spatial overlap.

```{r EDA}
#looking at all data points
#ggplot(wildschwein_BE, aes(E,N, colour = TierID)) +
#  geom_point() +
#  theme(legend.position = "none")

#schreck_locations needs to be transformed into the same coordinate system
schreck_locations_sf <- schreck_locations %>%
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>%
  st_transform(2056)

#plot wildschweins and schrecks together to see their spatial overlap
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf, aes(color=region)) +
  coord_sf(datum=2056)
#Die Tiere sind nur von Schrecks in der Region Fanel beeinträchtigt (kann das sein?)
```
As a result, it was found that the animals were only tracked around the Schreck in the region of Fanel. As a consequence, all other Schreck data points were removed and the spatial overlap replotted.

```{r filter all but region Fanel}
#alle anderen rausfiltern
schreck_locations_sf_fanel <- schreck_locations_sf %>%
  filter(region=="fanel")

#testen, ob dies stimmt
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf_fanel, aes(color=region)) +
  coord_sf(datum=2056)
```


In order to combine the data about the Schreck locations and their corresponding agenda, or sounding time, they were joined by their matching column "id" with an inner join.
Following this join, the agenda of all the "Schreck time" was visualized using an errorbar plot.

```{r join schreck agendas fanel}
agenda_fanel <- inner_join(schreck_locations_sf_fanel, schreck_agenda, by="id")

#show when the schrecks in fanel were used
ggplot(agenda_fanel, aes(xmin = datum_on, xmax = datum_off, y=id )) +
  geom_errorbarh()
```

# Schreck 1
In order to see which animals were tracked during the active period of the "Schreck", the boar data was filtered by the dates in which the Schreck were active.
For the tracked boars, a distance between their coordinates and the Schreck coordinate was calculated using st_distance().

To single out the boars which could have been affected by the Schreck, all boars wo never came into the radius of the "minimal Ausrichtung" of the Schreck were removed. The remaining distances were plotted against the DatetimeUTC column.


```{r distance to Schreck 1}
#1 Schreck rausfiltern
schreck1 <- agenda_fanel[1,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck1 <- filter(wildschwein_sf,DatetimeUTC>schreck1$datum_on,DatetimeUTC<schreck1$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck1$distance <- as.numeric(st_distance(wildschwein_schreck1,schreck1)[,1])

#Distanz der Hörweite ist unklar, daher nicht rausfiltern

#wildschwein_schreck1_close <- wildschwein_schreck1 %>%
 # filter(distance < 200)

#ggplot

ggplot(wildschwein_schreck1, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")
```
Since we don't know, how close you would need to be to hear the Schreck, all of the five boars Caroline, Isabelle, Nicole, Sabine and Ueli could potentially have been affected.

```{r distance to Schreck 1}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance_Schreck1 <- as.numeric(st_distance(wildschwein_sf,schreck1)[,1])

#Kandidaten rausfiltern
affected_distance <- wildschwein_sf %>%
  filter(TierName == c("Sabine","Isabelle"),DatetimeUTC > "2014-04-01 21:01:14", DatetimeUTC < "2014-12-28 21:01:14")

#ggplot
ggplot(affected_distance, aes(DatetimeUTC,distance_Schreck1, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")
```
Sabine and Isabelle don't seem to be impressed by the Schreck. However they only just came across the Schreck for 2 and 4 days accordingly before the Schreck stopped.

#Schreck 2

```{r distance to Schreck 2}
# Schreck rausfiltern
schreck2 <- agenda_fanel[2,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck2 <- filter(wildschwein_sf,DatetimeUTC>schreck2$datum_on,DatetimeUTC<schreck2$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck2$distance <- as.numeric(st_distance(wildschwein_schreck2,schreck2)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können --> die Spalte bedeutet etwas anderes, daher eher nicht nutzbar

#wildschwein_schreck_close <- wildschwein_schreck %>%
#  filter(distance < agenda_fanel$ausrichtung_min[2])

#ggplot

ggplot(wildschwein_schreck2, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_05")
```

#Schreck 3

```{r distance to Schreck}
# Schreck rausfiltern
schreck3 <- agenda_fanel[3,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck3 <- filter(wildschwein_sf,DatetimeUTC>schreck3$datum_on,DatetimeUTC<schreck3$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck3$distance <- as.numeric(st_distance(wildschwein_schreck3,schreck3)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können --> falsche Spalte, s.o.

#wildschwein_schreck_close <- wildschwein_schreck %>%
 # filter(distance < agenda_fanel$ausrichtung_min[3])

#ggplot

ggplot(wildschwein_schreck3, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_06")
```
Schreck 3 is not relevant.

#Schreck 4

```{r distance to Schreck 4}
# Schreck rausfiltern
schreck4 <- agenda_fanel[4,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck4 <- filter(wildschwein_sf,DatetimeUTC>schreck4$datum_on,DatetimeUTC<schreck4$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck4$distance <- as.numeric(st_distance(wildschwein_schreck4,schreck4)[,1])

#ggplot

ggplot(wildschwein_schreck4, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_06")
```
Ueli was the only one affected by Schreck 4.

#Schreck 5

```{r distance to Schreck 5}
# Schreck rausfiltern
schreck5 <- agenda_fanel[5,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck5 <- filter(wildschwein_sf,DatetimeUTC>schreck5$datum_on,DatetimeUTC<schreck5$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck5$distance <- as.numeric(st_distance(wildschwein_schreck5,schreck5)[,1])

#ggplot

ggplot(wildschwein_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Many boars could have been affected by Schreck 5, whereas only a few seem to have been close enough. The animals that were tracked further away will be filtered out.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance_Schreck5 <- as.numeric(st_distance(wildschwein_sf,schreck5)[,1])

#Kandidaten rausfiltern
affected_distance5 <- wildschwein_sf %>%
  filter(TierName == c("Caroline","Claude","Olga","Sabine"), DatetimeUTC > "2015-05-20 21:01:14",DatetimeUTC < "2015-06-12 21:01:14")

#ggplot
ggplot(affected_distance5, aes(DatetimeUTC,distance_Schreck5, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Schreck 5 was running from 2015-05-20 to 2015-06-12. It looks as if in the beginning the boars kept a distance of half a kilometer, but came back all the same after about a month.

```{r Caroline and Schreck 5}
distance5_longerThanSchrecking <- wildschwein_sf %>%
  filter(TierName == "Caroline", DatetimeUTC > "2015-04-01", DatetimeUTC < "2015-04-05")

ggplot(distance5_longerThanSchrecking,aes(DatetimeUTC,distance_Schreck5)) + geom_point()
```
Caroline's moving pattern shows her staying in one place during the days (mostly between 6-9 am to around 6pm) --> sleeping. Movements only at night. Further down, we'll explore which kind of field this Schreck 5 is in.

#Schreck 6

```{r distance to Schreck 6}
# Schreck rausfiltern
schreck6 <- agenda_fanel[6,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck6 <- filter(wildschwein_sf,DatetimeUTC>schreck6$datum_on,DatetimeUTC<schreck6$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck6$distance <- as.numeric(st_distance(wildschwein_schreck6,schreck6)[,1])

#ggplot

ggplot(wildschwein_schreck6, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```

Three boars look close enough to have heard the sound.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance <- as.numeric(st_distance(wildschwein_sf,schreck6)[,1])

#Kandidaten rausfiltern
affected_distance6 <- wildschwein_sf %>%
  filter(TierName == c("Caroline","Olga","Sabine"), DatetimeUTC > "2015-05-01 21:01:14",DatetimeUTC < "2015-08-12 21:01:14")

#ggplot
ggplot(affected_distance6, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Schreck 6 looks promising.

#Schreck 7

```{r distance to Schreck 7}
# Schreck rausfiltern
schreck7 <- agenda_fanel[7,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck7 <- filter(wildschwein_sf,DatetimeUTC>schreck7$datum_on,DatetimeUTC<schreck7$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck7$distance <- as.numeric(st_distance(wildschwein_schreck7,schreck7)[,1])

#ggplot

ggplot(wildschwein_schreck7, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_03")
```

Most likely, the Schreck 7 only had an effect on Ruth.


#Schreck 8

```{r distance to Schreck 8}
# Schreck rausfiltern
schreck8 <- agenda_fanel[8,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck8 <- filter(wildschwein_sf,DatetimeUTC>schreck8$datum_on,DatetimeUTC<schreck8$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck8$distance <- as.numeric(st_distance(wildschwein_schreck8,schreck8)[,1])

#ggplot

ggplot(wildschwein_schreck8, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_03")
```
Several boars were affected by Schreck 8.


#Schreck 9

```{r distance to Schreck 9}
# Schreck rausfiltern
schreck9 <- agenda_fanel[9,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck9 <- filter(wildschwein_sf,DatetimeUTC>schreck9$datum_on,DatetimeUTC<schreck9$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck9$distance <- as.numeric(st_distance(wildschwein_schreck9,schreck9)[,1])

#ggplot

ggplot(wildschwein_schreck9, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_04")
```
Schreck 9 affected many boars.


#Schreck 10

```{r distance to Schreck 10}
# Schreck rausfiltern
schreck10 <- agenda_fanel[10,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck10 <- filter(wildschwein_sf,DatetimeUTC>schreck10$datum_on,DatetimeUTC<schreck10$datum_off)


#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck10$distance <- as.numeric(st_distance(wildschwein_schreck10,schreck10)[,1])

#ggplot

ggplot(wildschwein_schreck10, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_04")
```
Schreck 10 was close enough for many.


#Schreck 11

```{r distance to Schreck 11}
# Schreck rausfiltern
schreck11 <- agenda_fanel[11,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck11 <- filter(wildschwein_sf,DatetimeUTC>schreck11$datum_on,DatetimeUTC<schreck11$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck11$distance <- as.numeric(st_distance(wildschwein_schreck11,schreck11)[,1])

#ggplot

ggplot(wildschwein_schreck11, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2016_01")
```
Many boars were affected by Schreck 11.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance_Schreck11 <- as.numeric(st_distance(wildschwein_sf,schreck11)[,1])

#Kandidaten rausfiltern
affected_distance11 <- wildschwein_sf %>%
  filter(TierName == c("Frida","Miriam", "Caroline", "Ueli","Amos"), DatetimeUTC > "2016-03-01 21:01:14",DatetimeUTC < "2016-05-12 21:01:14")

#ggplot
ggplot(affected_distance11, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2016_01")
```

Schreck 11 was running from 2016-04-04 to 2016-04-23. Amos seemed to move away, also Caroline, Ueli and Frida. --> this looks promising for further inspection.

##Step 4
Ueli looks like an interesting candidate for further inspection.
His corresponding location data to "Schreck time 1" were filtered and visualized in different ways.

```{r Ueli only with Schreck1}
#establish baseline distance of Ueli to Schreck1
Ueli_distance <- wildschwein_sf %>%
  filter(TierName == "Ueli")

Ueli_distance$distance <- as.numeric(st_distance(Ueli_distance,schreck1)[,1])

Ueli_schreck1 <- wildschwein_schreck1 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck=schreck1$id)

#ggplot() + geom_point(data=Ueli_distance,aes(DatetimeUTC,distance)) +
#  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))
#Ueli doesn't return to the Schreck1 location until 1.5 years later when he was sampled again
#Zoom in on the timeline:
Ueli_distance_2014 <- Ueli_distance %>%
  filter(lubridate::year(DatetimeUTC) == 2014)
ggplot() + geom_point(data=Ueli_distance_2014,aes(DatetimeUTC,distance)) +
  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))

(Ueli_schreck1_close <- wildschwein_schreck1_close %>%
  dplyr::filter(TierName=="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line())

# Ueli heard the sound for about 2 weeks and started going further away
#plot not only distance of 2000m but more:

ggplot(Ueli_schreck1, aes(DatetimeUTC,distance)) + geom_line()
# he came back after a while, even almost to 1000 m to the Schreck. But after the sound stopped, he wasn't sampled anymore --> we don't know if he returned in the meantime
```
Same thing with Isabelle and Sabine who should have been near enough to hear the schreck

```{r Sabine and Isabell only with Schreck1}
#establish baseline distance of Sabine and Isabelle to Schreck1
SabineIsabelle_distance <- wildschwein_sf %>%
  filter(TierName == c("Sabine","Isabelle"))

SabineIsabelle_distance$distance1 <- as.numeric(st_distance(SabineIsabelle_distance,schreck1)[,1])

#!!!!!!!!!Warum zeigt es das Datum nicht richtig an? Theoretisch sollte dies die gesamte Trackingzeit plotten. und wie es aussieht waren sie die ganze Zeit nie weiter als 200 m von Schreck 1 entfernt. Wenn das stimmt, waren sie von Schreck 1 komplett unbeeindruckt. Aber von deiner GRafik her weiss ich ja dass das nicht stimmt. Findest du den Fehler? --> Es waren überall Tippfehler...
ggplot(SabineIsabelle_distance, aes(DatetimeUTC,distance1)) + geom_line()

```

#Step 5
The other animals around Schreck 1 seemed to move in a different way. In order to see more of it, a facet grid was created.
To increase resolution and to show only the concurrently affected boars, Ueli was filtered out in a second facet grid visualization.

```{r facet plot of the returning patterns to Schreck 1}
(All_schreck1 <- wildschwein_schreck1_close_long%>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))

(AllButUeli_schreck1 <- wildschwein_schreck1_close_long%>%
    filter(TierName !="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))
```

#Step 6
Now, looking at the distances of Schreck 1 was interesting. Since we are trying to find general patterns (if possible) and later want to look at the returning patterns, all other Schrecks are about to be visualized in a similar fashion.

```{r distance to Schreck 2}
#Zweiten Schreck modellieren

#2. Schreck rausfiltern
schreck2 <- agenda_fanel[2,]

#Die Wildschweine zwischen dem Start und Ende des zweiten schrecks finden
wildschwein_schreck2 <- filter(wildschwein_sf,DatetimeUTC>schreck2$datum_on,DatetimeUTC<schreck2$datum_off)

#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck2$distance <- as.numeric(st_distance(wildschwein_schreck2,schreck2)[,1])

ggplot(wildschwein_schreck2, aes(DatetimeUTC, distance)) + geom_point()
#Alle Tiere, welche während der Laufzeit bis zu 2000m nah am Schreck 2 waren, hätten ihn hören können (Entscheidung Lia)

wildschwein_schreck2_close <- wildschwein_schreck2 %>%
  filter(distance < 2000)

Ueli_schreck2 <- wildschwein_schreck2 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck = schreck2$id)

ggplot() + geom_sf(data=wildschwein_schreck2_close, aes(color=TierName)) +
  geom_sf(data=schreck2,aes(fill=id)) + coord_sf(datum=2056)

#ggplot(wildschwein_schreck2_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05 (without fence)")

#comparison between Schreck 1 & Schreck 2
ggplot() +
  geom_line(data=Ueli_schreck1, aes(DatetimeUTC,distance)) +
  geom_line(data=Ueli_schreck2, aes(DatetimeUTC,distance)) +
  labs(title="Ueli's distance to concurrently sounding Schrecks")
```

# Step 7
As a measure to reduce data point density, only every 50th observation was used. The loss in data granularity has an effect for readability and observability of a general movement trend, and it doesn't seem that a lot of the information is lost on the way.

In the following graph, distances from Ueli to the two first Schrecks are visualized with a much lower resolution.

```{r reduction in sampling size concurrent Schrecks 1 + 2}

#use only every 50th observation point to reduce complexity
reduce_Ueli_schreck1 <- Ueli_schreck1 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_Ueli_schreck2 <- Ueli_schreck2 %>% dplyr::filter(row_number() %% 50 == 0)

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

#Step 8
A similar approach was used for the other boars affected by Schreck 1 and 2, but even reducing their data points to every 150th.


```{r distance to Schreck 1 & 2 all animals except Ueli}
wildschwein_schreck1$Schreck <- schreck1$id
wildschwein_schreck2$Schreck <- schreck2$id

reduce_schreck1 <- wildschwein_schreck1 %>% dplyr::filter(row_number() %% 150 == 0)
reduce_schreck2 <- wildschwein_schreck2 %>% dplyr::filter(row_number() %% 150 == 0)

reduce_schreck1_withoutUeli <- reduce_schreck1 %>%
  filter(TierName != "Ueli")
reduce_schreck2_withoutUeli <- reduce_schreck2 %>%
  filter(TierName != "Ueli")

ggplot(reduce_schreck1_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the other affected boars to Schreck WSS_2014_04")

ggplot(reduce_schreck2_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05")
```
Only Sabine seems to have an interesting pattern or was close enough to be affected so here is Sabine's distance to the first 2 Schrecks:

```{r Sabine against Schreck 1,2}
#Now we'll look at Sabine alone (the others don't show a useful pattern)
reduce_schreck1_Sabine <- reduce_schreck1_withoutUeli %>%
  filter(TierName =="Sabine")
reduce_schreck2_Sabine <- reduce_schreck2_withoutUeli %>%
  filter(TierName =="Sabine")

#inspect pattern of the two Schrecks together
ggplot() +
  geom_line(data=reduce_schreck1_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_schreck2_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Sabine's distance to concurrent Schrecks, sampling size reduced")

#They start to move further away, initially, but come back later anyways
```

# Step 9
No animal was around at the "Schreck time" of Schreck 3 so it will be omitted for further analyses.
Schreck 4 could only affect our friend Ueli so he will be analysed on his own.
Apparently, this Schreck was active almost at the same time as Schreck 1 and 2, so all distances to the 3 Schrecks were visualized together for Ueli.
It's almost eerie how similar his distancing behavior looks...

```{r distance to Schreck 4}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#3. bzw. 4. Schreck rausfiltern
#schreck3 <- agenda_fanel[3,]
schreck4 <- agenda_fanel[4,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
#wildschwein_schreck3 <- #filter(wildschwein_sf,DatetimeUTC>schreck3$datum_on,DatetimeUTC<schreck3$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck4 <- filter(wildschwein_sf,DatetimeUTC>schreck4$datum_on,DatetimeUTC<schreck4$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
#wildschwein_schreck3$distance <- #as.numeric(st_distance(wildschwein_schreck3,schreck3)[,1])
wildschwein_schreck4$distance <- as.numeric(st_distance(wildschwein_schreck4,schreck4)[,1])

wildschwein_schreck4$Schreck <- schreck4$id

ggplot() + geom_sf(data=wildschwein_schreck4, aes(color=TierName)) +
  geom_sf(data=schreck4,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck4, aes(DatetimeUTC,distance, color=Schreck)) + geom_line() + labs(title="Distance of the only affected boar Ueli to Schreck WSS_2014_06 (aggressive)")

reduce_Ueli_schreck4 <- wildschwein_schreck4 %>% dplyr::filter(row_number() %% 50 == 0)

#inspect pattern of 3 Schrecks on Ueli

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck4, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

#Step 10
Schreck 5 and 6 are the same but move from standard to aggressive mode.
Their distances were visualized with the close animals (ca. <1300m) and only every 50th observation was plotted.
The change in mode was visualized using a different line style.

```{r distance to Schreck 5 & 6}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#5. bzw. 6. Schreck rausfiltern
schreck5 <- agenda_fanel[5,]
schreck6 <- agenda_fanel[6,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck5 <- filter(wildschwein_sf,DatetimeUTC>schreck5$datum_on,DatetimeUTC<schreck5$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck6 <- filter(wildschwein_sf,DatetimeUTC>schreck6$datum_on,DatetimeUTC<schreck6$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck5$distance <- as.numeric(st_distance(wildschwein_schreck5,schreck5)[,1])
wildschwein_schreck6$distance <- as.numeric(st_distance(wildschwein_schreck6,schreck6)[,1])

wildschwein_schreck6$Schreck <- schreck6$id
wildschwein_schreck5$Schreck <- schreck5$id

#ggplot() + geom_sf(data=wildschwein_schreck5, aes(color=TierName)) +
#  geom_sf(data=schreck5,aes(fill=id)) + coord_sf(datum=2056)

#ggplot(wildschwein_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

reduce_schreck5 <- wildschwein_schreck5 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_schreck6 <- wildschwein_schreck6 %>% dplyr::filter(row_number() %% 50 == 0)

#ggplot(reduce_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

#ggplot(reduce_schreck6, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (aggressive)")

#Now I'll filter out the boars that are too far away:
reduce_schreck5_close <- reduce_schreck5 %>%
 filter(distance<=1300)

reduce_schreck6_close <- reduce_schreck6 %>%
  filter(TierName != "Franz",
         TierName != "Rosa",
         TierName != "Ruth")

#ggplot(reduce_schreck5_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

#ggplot() +
#  geom_line(data=reduce_schreck5, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
#  geom_line(data=reduce_schreck6, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
 # labs(title="Boar's distance to Schrecks changing from standard to aggressive sound, sampling size reduced")

#looking at the close animals
ggplot() +
  geom_line(data=reduce_schreck5_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck6_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Close Boar's distance to Schrecks changing from standard to aggressive mode, sampling size reduced")
#They start to move further away, initially, but come back later anyways
```
#Step 11
A similar thing was done with Schreck 7 & 8, and only Ruth was close enough to possibly hear the Schreck sound (<1500m).

```{r distance to Schreck 7 & 8}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#5. bzw. 6. Schreck rausfiltern
schreck7 <- agenda_fanel[7,]
schreck8 <- agenda_fanel[8,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck7 <- filter(wildschwein_sf,DatetimeUTC>schreck7$datum_on,DatetimeUTC<schreck7$datum_off)

wildschwein_schreck8 <- filter(wildschwein_sf,DatetimeUTC>schreck8$datum_on,DatetimeUTC<schreck8$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck7$distance <- as.numeric(st_distance(wildschwein_schreck7,schreck7)[,1])
wildschwein_schreck8$distance <- as.numeric(st_distance(wildschwein_schreck8,schreck8)[,1])

wildschwein_schreck7$Schreck <- schreck7$id
wildschwein_schreck8$Schreck <- schreck8$id

#ggplot() + geom_sf(data=wildschwein_schreck7, aes(color=TierName)) +
#  geom_sf(data=schreck7,aes(fill=id)) + coord_sf(datum=2056)

reduce_schreck7 <- wildschwein_schreck7 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_schreck8 <- wildschwein_schreck8 %>% dplyr::filter(row_number() %% 50 == 0)

#ggplot() + geom_line(data=reduce_schreck7, aes(DatetimeUTC,distance, color=TierName)) +
#  geom_line(data=reduce_schreck8, aes(DatetimeUTC,distance, color=TierName)) +
#  labs(title="Distance of the affected boars to Schreck WSS_2015_03 (standard & aggressive)")

#Now I'll filter out the boars that are too far away:
reduce_schreck7_close <- reduce_schreck7 %>%
  filter(TierName == "Ruth")
reduce_schreck8_close <- reduce_schreck8 %>%
  filter(TierName == "Ruth")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

ggplot() +
  geom_line(data=reduce_schreck7_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck8_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Ruth's distance to Schreck WSS_2015_03 changing from standard to aggressive mode, sampling size reduced")
#sometimes she stays away a bit more but even the aggressive sound doesn't help much
```

#Step 12


```{r distance to Schreck 9 & 10}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

# Schreck rausfiltern
schreck9 <- agenda_fanel[9,]
schreck10 <- agenda_fanel[10,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck9 <- filter(wildschwein_sf,DatetimeUTC>schreck9$datum_on,DatetimeUTC<schreck9$datum_off)

wildschwein_schreck10 <- filter(wildschwein_sf,DatetimeUTC>schreck10$datum_on,DatetimeUTC<schreck10$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck9$distance <- as.numeric(st_distance(wildschwein_schreck9,schreck9)[,1])
wildschwein_schreck10$distance <- as.numeric(st_distance(wildschwein_schreck10,schreck10)[,1])

wildschwein_schreck9$Schreck <- schreck9$id
wildschwein_schreck10$Schreck <- schreck10$id

#ggplot() + geom_sf(data=wildschwein_schreck9, aes(color=TierName)) +
  geom_sf(data=schreck9,aes(fill=id)) + coord_sf(datum=2056)

reduce_schreck9 <- wildschwein_schreck9 %>% dplyr::filter(row_number() %% 150 == 0)
reduce_schreck10 <- wildschwein_schreck10 %>% dplyr::filter(row_number() %% 150 == 0)

reduce_schreck9_close <- wildschwein_schreck9 %>%
  filter(distance < 2700)
reduce_schreck10_close <- wildschwein_schreck10 %>%
  filter(distance < 2700)

#ggplot() + geom_line(data=reduce_schreck9_close, aes(DatetimeUTC,distance, color=TierName)) +
#  labs(title="Distance of the affected boars to Schreck WSS_2015_04 (standard)")

#ggplot() + geom_line(data=reduce_schreck10_close, aes(DatetimeUTC,distance, color=TierName)) + labs(title="Distance of the affected boars to Schreck WSS_2015_04 (louder)")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

ggplot() +
  geom_line(data=reduce_schreck9_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck10_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Ruth's distance to Schreck WSS_2015_03 changing from standard to aggressive mode, sampling size reduced")
#sometimes she stays away a bit more but even the aggressive sound doesn't help much
```


```{r Schreck 5 and 6 is in a bean field}
forest <- read_sf("Feldaufnahmen_Fanel.gpkg")
head(forest)
schreck5 <- agenda_fanel[5,]
schreck6 <- agenda_fanel[6,]
#schreck9 <- agenda_fanel[9,]
schreck10 <- agenda_fanel[10,]

st_intersects(schreck5, forest) # sagt, wo sich der Punkt des Schrecks mit den Feld-Daten kreuzt
#Resultat: 272 -->FieldID 195
st_intersects(schreck6,forest) #same field

#schreck7 <- agenda_fanel[7,]
#schreck8 <- agenda_fanel[8,]

#st_intersects(schreck7, forest) # sagt, wo sich der Punkt des Schrecks mit den Feld-Daten kreuzt
#Resultat: 393
#st_intersects(schreck8,forest) #same field

#st_intersects(schreck9, forest)
#Resultat: 375
st_intersects(schreck10,forest)

forest_bohnen195 <- forest %>%
  filter(FieldID==195)

#forest_bohnen393 <- forest %>%
#  filter(FieldID==393)

#forest_bohnen375 <- forest %>%
#  filter(FieldID==375)

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck5)
ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck6)

#ggplot(forest_bohnen393)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck7)
#Schreck 7 and 8 are an Acker field!

#ggplot(forest_bohnen375)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck9)
#Schreck 9+10 nicht relevant für Caroline während Schreck time
```

Caroline wird genauer betrachtet im Bezug auf Schreck 5 + 6:

```{r Caroline during Schreck 5 and 6}
#5+6 ist in einem Feld, wo Caroline rumgeht

distance5_Caroline_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Caroline", DatetimeUTC > "2015-05-20", DatetimeUTC < "2015-06-12")
distance6_Caroline_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Caroline", DatetimeUTC > "2015-06-12", DatetimeUTC < "2015-07-01")

#distance7_Caroline_Schrecktime <-wildschwein_sf %>%
 # filter(TierName == "Caroline", DatetimeUTC > "2015-05-22", DatetimeUTC < "2015-06-12")

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance5_Caroline_Schrecktime)
ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance6_Caroline_Schrecktime)

#ggplot(forest_bohnen393)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance7_Caroline_Schrecktime)
#Schreck 7, 8 respectively doesn't seem relevant for Caroline

#distance8_Caroline_Schrecktime <-wildschwein_sf %>%
#  filter(TierName == "Caroline", DatetimeUTC > "2015-06-12", DatetimeUTC < "2015-07-01")
#ggplot(forest_bohnen393)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance8_Caroline_Schrecktime)


intersection_195andSchreck5 <- st_intersects(forest_bohnen195,distance5_Caroline_Schrecktime)
intersection_195andSchreck6 <- st_intersects(forest_bohnen195,distance6_Caroline_Schrecktime)
class(intersection_195andSchreck5)

inter_sel_5 <- distance5_Caroline_Schrecktime[intersection_195andSchreck5[[1]],]
inter_sel_6 <- distance6_Caroline_Schrecktime[intersection_195andSchreck6[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Caroline's positions in the bean field while Schreck 5 was active")
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_6) + geom_sf(data=schreck6, aes(size=5)) + labs(title="Caroline's positions in the bean field while Schreck 6 was active")
  #during Schreck time, Carolina still visited the bean field (during Standard and aggressive mode)
```

As can be seen, Schreck 5 & 6 is in a bean field (mode standard and then aggressive. Caroline made some visits during Schreck time.
To see when Caroline is returning into it, I'd like to set the field polygon as the defining area where the distance is measured. --> column that says: "in the field" or "not in the field"

```{r Caroline in the field vs not in the field Schreck 5 and 6}
#ich will jetzt das Feld definieren. Im Feld drin = TRUE --> alle in inter_sel_5
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5 <- st_disjoint(forest_bohnen195,distance5_Caroline_Schrecktime)
disjoint_195andSchreck6 <- st_disjoint(forest_bohnen195,distance6_Caroline_Schrecktime)
class(intersection_195andSchreck5)

disjoint_caroline_5 <- distance5_Caroline_Schrecktime[disjoint_195andSchreck5[[1]],]
disjoint_caroline_6 <- distance6_Caroline_Schrecktime[disjoint_195andSchreck6[[1]],]

#disjoint anschauen
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_caroline_5) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Caroline's positions outside bean field while Schreck 5 was active")
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_caroline_6) + geom_sf(data=schreck6, aes(size=5)) + labs(title="Caroline's positions outside bean field while Schreck 6 was active")

#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_caroline_5$inField <- 0
disjoint_caroline_6$inField <- 0
inter_sel_5$inField <- 1
inter_sel_6$inField <- 1
#append the two data sets again with their new columns
Caroline_Schreck5_withField <- bind_rows(disjoint_caroline_5,inter_sel_5)
Caroline_Schreck6_withField <- bind_rows(disjoint_caroline_6,inter_sel_6)
#bis hier stimmt es schon mal

Caroline_Schreck5_withField$distance5 <- as.numeric(st_distance(Caroline_Schreck5_withField$geometry,schreck5)[,1])
Caroline_Schreck6_withField$distance6 <- as.numeric(st_distance(Caroline_Schreck6_withField$geometry,schreck6)[,1])

#this is now the pattern during Schreck time --> red points don't say a lot yet, just that she was in the field --> conceptualize better?
ggplot() + geom_point(data=Caroline_Schreck5_withField,aes(DatetimeUTC,distance5)) +
  geom_point(data=inter_sel_5,aes(DatetimeUTC,inField, colour="red"))
ggplot() + geom_point(data=Caroline_Schreck6_withField,aes(DatetimeUTC,distance6)) +
  geom_point(data=inter_sel_6,aes(DatetimeUTC,inField, colour="red"))
```


```{r Caroline longer time span}
Caroline_longerThanSchrecktime <- wildschwein_sf %>%
  filter(TierName == "Caroline")

Caroline_longerThanSchrecktime$distance5_6 <-
  as.numeric(st_distance(Caroline_longerThanSchrecktime$geometry,schreck5)[,1])
#don't need to do it for Schreck 6 because it is the same with different mode

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=Caroline_longerThanSchrecktime)

intersection_195andSchreck5_6_long <- st_intersects(forest_bohnen195,Caroline_longerThanSchrecktime)
class(intersection_195andSchreck5)

inter_sel_5_6_long <- Caroline_longerThanSchrecktime[intersection_195andSchreck5_6_long[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5_6_long) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Caroline's positions in the bean field during the whole time")
  #during Schreck time, Carolina still visited the bean field

#ich will jetzt das Feld definieren. Im Feld drin = TRUE --> alle in inter_sel_5_long
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5_6_long <- st_disjoint(forest_bohnen195,Caroline_longerThanSchrecktime)
#class(intersection_195andSchreck5_6_long)

disjoint_caroline_5_6_long <- Caroline_longerThanSchrecktime[disjoint_195andSchreck5_6_long[[1]],]

#disjoint anschauen --> ok!
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_caroline_5_6_long) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Caroline's positions outside bean field during the whole time")

#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_caroline_5_6_long$inField <- 0
inter_sel_5_6_long$inField <- 1
#append the two data sets again with their new columns
Caroline_Schreck5_6_withField_long <- bind_rows(disjoint_caroline_5_6_long,inter_sel_5_6_long)

#this is now the pattern during the whole time --> red points are in Field
ggplot() + geom_point(data=Caroline_Schreck5_6_withField_long,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Caroline's distance to Schreck 5 / 6 during whole tracking time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```
Reduce timescale to March 2015 until November 2015 for Caroline
```{r Caroline smaller timescale}
Caroline_Schreck5_6_withField_long_aroundInFieldtime <- Caroline_Schreck5_6_withField_long %>%
  filter(DatetimeUTC>"2015-04-15", DatetimeUTC<"2015-08-15")
inter_sel_5_6_long_shorter <- inter_sel_5_6_long %>%
  filter(DatetimeUTC<"2015-08-15")

ggplot() + geom_point(data=Caroline_Schreck5_6_withField_long_aroundInFieldtime,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long_shorter,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Caroline's distance to Schreck 5 / 6 around inField time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```
Next thing to do is add a background color that shows "Before Schrecktime" - "during Schrecktime" - "after Schrecktime"
https://statisticsglobe.com/draw-ggplot2-plot-different-background-colors-region-r

```{r Caroline with background color}
Caroline_breaks <- data.frame(start=as.Date(c("2015-04-15","2015-05-20","2015-06-12","2015-07-01")),
                              end=as.Date(c("2015-05-20","2015-06-12","2015-07-01","2015-08-15")),
                              colors=factor(1:4),
                              name=c("before","S5","S6","after"))
Caroline_breaks

ggplot() +
  geom_rect(data = Caroline_breaks,
            aes(xmin = start,
                xmax = end,
                ymin = - Inf,
                ymax = Inf,
                fill = colors),
            alpha = 0.5) +
  geom_point(data=Caroline_Schreck5_6_withField_long_aroundInFieldtime,aes(as.Date(DatetimeUTC),distance5_6)) +
  geom_point(data=inter_sel_5_6_long_shorter,aes(as.Date(DatetimeUTC),inField, colour="red")) +
  labs(title="Caroline's distance to Schreck 5 / 6 around inField time. Red points mean: in the bean field")

#Variante mit weniger Datenpunkten:
Caroline_Schreck5_6_withField_long_aroundInFieldtime_smooth <- Caroline_Schreck5_6_withField_long_aroundInFieldtime %>%
  dplyr::filter(row_number() %% 150 == 0)

ggplot() +
  geom_rect(data = Caroline_breaks,
            aes(xmin = start,
                xmax = end,
                ymin = - Inf,
                ymax = Inf,
                fill = colors),
            alpha = 0.5) + 
  geom_line(data=Caroline_Schreck5_6_withField_long_aroundInFieldtime_smooth,aes(as.Date(DatetimeUTC),distance5_6)) +
  geom_point(data=inter_sel_5_6_long_shorter,aes(as.Date(DatetimeUTC),inField, colour="red")) +
  labs(title="Caroline's distance to Schreck 5 / 6 around inField time. Red points mean: in the bean field")
#missing: legend and color annotations, some graphical and text adjustments, interpretation

```

Repeating Schreck 5 & 6 with Olga
```{r Olga during Schrecktime 5 and 6}
distance5_Olga_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Olga", DatetimeUTC > "2015-05-20", DatetimeUTC < "2015-06-12")

distance6_Olga_Schrecktime <-wildschwein_sf %>%
  filter(TierName == "Olga", DatetimeUTC > "2015-06-12", DatetimeUTC < "2015-07-01")

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance5_Olga_Schrecktime)

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance6_Olga_Schrecktime)
#Olga was in and around the fields 5 & 6 a lot!

intersection_195andSchreck5_olga <- st_intersects(forest_bohnen195,distance5_Olga_Schrecktime)
intersection_195andSchreck6_olga <- st_intersects(forest_bohnen195,distance6_Olga_Schrecktime)

inter_sel_5_olga <- distance5_Olga_Schrecktime[intersection_195andSchreck5_olga[[1]],]
inter_sel_6_olga <- distance6_Olga_Schrecktime[intersection_195andSchreck6_olga[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5_olga) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Olga's positions in the bean field while Schreck 5 was active")
  #during Schreck time, Olga still visited the bean field

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_6_olga) + geom_sf(data=schreck6, aes(size=5)) + labs(title="Olga's positions in the bean field while Schreck 6 was active")
```
Aside from Caroline, also Olga visited the same bean field during Schreck time 5 & 6!

```{r Olga longer time span}
Olga_longerThanSchrecktime <- wildschwein_sf %>%
  filter(TierName == "Olga")

Olga_longerThanSchrecktime$distance5_6 <-
  as.numeric(st_distance(Olga_longerThanSchrecktime$geometry,schreck5)[,1])
#don't need to do it for Schreck 6 because it is the same with different mode

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=Olga_longerThanSchrecktime)

intersection_195andSchreck5_6_long_olga <- st_intersects(forest_bohnen195,Olga_longerThanSchrecktime)
#class(intersection_195andSchreck5)

inter_sel_5_6_long_olga <- Olga_longerThanSchrecktime[intersection_195andSchreck5_6_long_olga[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5_6_long_olga) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Olga's positions in the bean field during the whole time")
  #during Schreck time, Carolina still visited the bean field

#ich will jetzt das Feld definieren. Im Feld drin = TRUE --> alle in inter_sel_5_long
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5_6_long_olga <- st_disjoint(forest_bohnen195,Olga_longerThanSchrecktime)
#class(intersection_195andSchreck5_long)

disjoint_Olga_5_6_long <- Olga_longerThanSchrecktime[disjoint_195andSchreck5_6_long_olga[[1]],]

#disjoint anschauen --> ok!
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_Olga_5_6_long) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Olga's positions outside bean field during the whole time")

#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_Olga_5_6_long$inField <- 0
inter_sel_5_6_long_olga$inField <- 1
#append the two data sets again with their new columns
Olga_Schreck5_6_withField_long <- bind_rows(disjoint_Olga_5_6_long,inter_sel_5_6_long_olga)

#this is now the pattern during the whole time --> red points are in Field
ggplot() + geom_point(data=Olga_Schreck5_6_withField_long,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long_olga,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Olga's distance to Schreck 5 / 6 during whole tracking time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```

Reduce timescale to until End of August for Olga
```{r Olga smaller timescale}
Olga_Schreck5_6_withField_long_aroundInFieldtime <- Olga_Schreck5_6_withField_long %>%
  filter(DatetimeUTC<"2015-08-01")

ggplot() + geom_point(data=Olga_Schreck5_6_withField_long_aroundInFieldtime,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long_olga,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Olga's distance to Schreck 5 / 6 around inField time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```

Repeating Schreck 5 & 6 with Sabine
```{r Sabine during Schrecktime 5 and 6}
distance5_Sabine_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Sabine", DatetimeUTC > "2015-05-20", DatetimeUTC < "2015-06-12")

distance6_Sabine_Schrecktime <-wildschwein_sf %>%
  filter(TierName == "Sabine", DatetimeUTC > "2015-06-12", DatetimeUTC < "2015-07-01")

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance5_Sabine_Schrecktime)

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance6_Sabine_Schrecktime)
#Sabine was in and around the fields 5 & 6 a lot!

intersection_195andSchreck5_Sabine <- st_intersects(forest_bohnen195,distance5_Sabine_Schrecktime)
intersection_195andSchreck6_Sabine <- st_intersects(forest_bohnen195,distance6_Sabine_Schrecktime)

inter_sel_5_Sabine <- distance5_Sabine_Schrecktime[intersection_195andSchreck5_Sabine[[1]],]
inter_sel_6_Sabine <- distance6_Sabine_Schrecktime[intersection_195andSchreck6_Sabine[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5_Sabine) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Sabine's positions in the bean field while Schreck 5 was active")
  #during Schreck time, Sabine still visited the bean field

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_6_Sabine) + geom_sf(data=schreck6, aes(size=5)) + labs(title="Sabine's positions in the bean field while Schreck 6 was active")
```
Aside from Caroline and Olga, also Sabine visited the same bean field during Schreck time 5 & 6!

```{r Sabine longer time span}
Sabine_longerThanSchrecktime <- wildschwein_sf %>%
  filter(TierName == "Sabine")

Sabine_longerThanSchrecktime$distance5_6 <-
  as.numeric(st_distance(Sabine_longerThanSchrecktime$geometry,schreck5)[,1])
#don't need to do it for Schreck 6 because it is the same with different mode

ggplot(forest_bohnen195)+geom_sf(aes(fill=Frucht)) + geom_sf(data=Sabine_longerThanSchrecktime)

intersection_195andSchreck5_6_long_Sabine <- st_intersects(forest_bohnen195,Sabine_longerThanSchrecktime)
#class(intersection_195andSchreck5)

inter_sel_5_6_long_Sabine <- Sabine_longerThanSchrecktime[intersection_195andSchreck5_6_long_Sabine[[1]],]

ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=inter_sel_5_6_long_Sabine) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Sabine's positions in the bean field during the whole time")
  #during Schreck time, Sabine still visited the bean field

#ich will jetzt das Feld definieren. Im Feld drin = TRUE --> alle in inter_sel_5_long
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5_6_long_Sabine <- st_disjoint(forest_bohnen195,Sabine_longerThanSchrecktime)
#class(intersection_195andSchreck5_long)

disjoint_Sabine_5_6_long <- Sabine_longerThanSchrecktime[disjoint_195andSchreck5_6_long_Sabine[[1]],]

#disjoint anschauen --> ok!
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_Sabine_5_6_long) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Sabine's positions outside bean field during the whole time")

#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_Sabine_5_6_long$inField <- 0
inter_sel_5_6_long_Sabine$inField <- 1
#append the two data sets again with their new columns
Sabine_Schreck5_6_withField_long <- bind_rows(disjoint_Sabine_5_6_long,inter_sel_5_6_long_Sabine)

#this is now the pattern during the whole time --> red points are in Field
ggplot() + geom_point(data=Sabine_Schreck5_6_withField_long,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long_Sabine,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Sabine's distance to Schreck 5 / 6 during whole tracking time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```

Reduce timescale to after May for Sabine
```{r Sabine smaller timescale}
Sabine_Schreck5_6_withField_long_aroundInFieldtime <- Sabine_Schreck5_6_withField_long %>%
  filter(DatetimeUTC>"2015-06-01")

ggplot() + geom_point(data=Sabine_Schreck5_6_withField_long_aroundInFieldtime,aes(DatetimeUTC,distance5_6)) +
  geom_point(data=inter_sel_5_6_long_Sabine,aes(DatetimeUTC,inField, colour="red")) +
  labs(title="Sabine's distance to Schreck 5 / 6 around inField time. Red points mean: in the bean field")
#hier noch  zu ergänzen: Linien, wann die Schrecks aktiv sind (z.B. https://stackoverflow.com/questions/66825661/vertical-lines-for-data-points-in-geom-point-in-ggplot2-for-r)
```

```{r Miriam Schreck 11}
schreck11 <- agenda_fanel[11,]
#schreck12 <- agenda_fanel[12,]
#schreck13 <- agenda_fanel[13,]
#schreck14 <- agenda_fanel[14,]

st_intersects(schreck11, forest) # sagt, wo sich der Punkt des Schrecks mit den Feld-Daten kreuzt
#Resultat: 4
#st_intersects(schreck12,forest) #Resultat: 576

#st_intersects(schreck13, forest)
#Resultat: 374
#st_intersects(schreck14,forest) #Resultat: 290

forest_4 <- forest %>%
  filter(FieldID==4)
#forest_576 <- forest %>%
#  filter(FieldID==576)
#forest_374 <- forest %>%
#  filter(FieldID==374)
#forest_290 <- forest %>%
#  filter(FieldID==290)

#install.packages("ggpubr")
#library(ggpubr)

#ggarrange(
#  ggplot(forest_4)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck11),
#  ggplot(forest_576)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck12),
#  ggplot(forest_374)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck13),
#  ggplot(forest_290)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck14))
#die sehen alle ein wenig weit weg aus... aber könnten auch wenige Meter Abstand sein


distance11_Miriam_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Miriam", DatetimeUTC > "2016-04-04", DatetimeUTC < "2016-04-23")
#distance12_Miriam_Schrecktime <- wildschwein_sf %>%
#  filter(TierName == "Miriam", DatetimeUTC > "2016-06-15", DatetimeUTC < "2016-07-15")
#distance14_Miriam_Schrecktime <- wildschwein_sf %>%
#  filter(TierName == "Miriam", DatetimeUTC > "2016-09-29", DatetimeUTC < "2016-10-04")

ggplot(forest_4)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance11_Miriam_Schrecktime)
#während Schrecktime 11 war sie nie auf dem Feld

#ggplot(forest_576)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance12_Miriam_Schrecktime)
#gleich wie Schreck 12
#ggplot(forest_374)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance12_Miriam_Schrecktime)
#same

#ggplot(forest_290)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance14_Miriam_Schrecktime)

#Miriam war nicht von den Schrecks 2016  betroffen :(


#distance11_Amos_Schrecktime <- wildschwein_sf %>%
#  filter(TierName == "Amos", DatetimeUTC > "2016-04-04", DatetimeUTC < "2016-04-23")
#distance12_Amos_Schrecktime <- wildschwein_sf %>%
#  filter(TierName == "Amos", DatetimeUTC > "2016-06-15", DatetimeUTC < "2016-07-15")
#distance14_Amos_Schrecktime <- wildschwein_sf %>%
#  filter(TierName == "Amos", DatetimeUTC > "2016-09-29", DatetimeUTC < "2016-10-04")

#ggplot(forest_4)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance11_Amos_Schrecktime)
#während Schrecktime 11 war sie nie auf dem Feld

#ggplot(forest_576)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance12_Amos_Schrecktime)
#gleich wie Schreck 12
#ggplot(forest_374)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance12_Amos_Schrecktime)
#same

#ggplot(forest_290)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance14_Amos_Schrecktime)
#Auch Amos war wohl nicht in der Nähe, falls ich es richtig überlegt habe...
```
Miriam was not in the Weide field during Schreck time 11 (but maybe before or after) - exclude her anyways

```{r Ueli with Schreck 1, eval=FALSE, include=FALSE}
schreck1 <- agenda_fanel[1,]

st_intersects(schreck1, forest) # sagt, wo sich der Punkt des Schrecks mit den Feld-Daten kreuzt
#Resultat: 273

forest_273 <- forest %>%
  filter(FieldID==273)

#sieht auch ein wenig weit weg aus... aber könnten auch wenige Meter Abstand sein

ggplot(forest_273)+geom_sf(aes(fill=Frucht)) + geom_sf(data=schreck1)

distance1_Ueli_Schrecktime <- wildschwein_sf %>%
  filter(TierName == "Ueli", DatetimeUTC > "2014-05-01", DatetimeUTC < "2014-10-28")

ggplot(forest_273)+geom_sf(aes(fill=Frucht)) + geom_sf(data=distance1_Ueli_Schrecktime)
#Ueli war nie direkt auf dem Feld während Schrecktime :(
```




#next step
How much time does a boar spend in the field before the Schreck (in %), during and after? 

Selection of the boars and schrecks which will be analyzed further:
Schreck 1 and 2 and 4 will de disregarded because there is no data of boars that were tracked in this region before, during and after the schreck. So there would be nothing to compare the schrecks effect with.

Schreck 3 will be disregarded because no boar was tracked in its vicinity. 

Schreck 7, 8 and 9 will be disregarded because only one boar fulfills requirements of being tracked in the area before, during and after Schreck-time respectively. This would again pose the problem of lacking comparability.

Hence only Schreck 5, 6, 10, and 11 will be further analyzed.

For Schreck 5 and 6, respectively, the boars Olga, Sabine and Caroline will be further examined, because they were in the area as well as tracked before and after. 
The same applies for Schreck 10 with Ruth, Sabine, Olga and Caroline.

For Schreck 11 it will be Miriam, Frida, Caroline and Ueli.

```{r in the field vs not in the field during SChreck time}
#Im Feld drin = TRUE --> alle in inter_sel_5


disjoint_195andSchreck5 <- st_disjoint(forest_bohnen195,distance5_Caroline_Schrecktime)
class(intersection_195andSchreck5)

disjoint_caroline_5 <- distance5_Caroline_Schrecktime[disjoint_195andSchreck5[[1]],]


#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_caroline_5$inField <- 0
inter_sel_5$inField <- 1
#append the two data sets again with their new columns
Caroline_Schreck5_withField <- bind_rows(disjoint_caroline_5,inter_sel_5)

  


#47 from 2207 Data points are in the field
print(47/2207*100)
# during Schreck time she spends 2 % of her time in the field.

# now the same for before and after

#Idea: also display graphically the distribution of "In" and "Not In" Before, during and after
```

```{r in the field vs not in the field before SChreck time}
#Im Feld drin = TRUE --> alle in inter_sel_5
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5 <- st_disjoint(forest_bohnen195,distance5_Caroline_Schrecktime)
class(intersection_195andSchreck5)

disjoint_caroline_5 <- distance5_Caroline_Schrecktime[disjoint_195andSchreck5[[1]],]

#disjoint anschauen
ggplot(forest_bohnen195) + geom_sf(aes(fill=Frucht))+ geom_sf(data=disjoint_caroline_5) + geom_sf(data=schreck5, aes(size=5)) + labs(title="Caroline's positions outside bean field while Schreck 5 was active")

#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_caroline_5$inField <- 0
inter_sel_5$inField <- 1
#append the two data sets again with their new columns
Caroline_Schreck5_withField <- bind_rows(disjoint_caroline_5,inter_sel_5)
#bis hier stimmt es schon mal

#this is now the pattern during Schreck time --> red points don't say a lot yet, just that she was in the field --> conceptualize better?
ggplot() + geom_point(data=Caroline_Schreck5_withField,aes(DatetimeUTC,distance_Schreck5)) +
  geom_point(data=inter_sel_5,aes(DatetimeUTC,inField, colour="red"))
  


#47 from 2207 Data points are in the field
print(47/2207*100)
# during Schreck time she spends 2 % of her time in the field.

# now the same for before and after
```



```{r in the field vs not in the field after SChreck time}
#Im Feld drin = TRUE --> alle in inter_sel_5
#für die "nicht enthaltenen" kann ich einen anti-join nutzen oder das Subsetting mit disjoint

disjoint_195andSchreck5 <- st_disjoint(forest_bohnen195,distance5_Caroline_Schrecktime)
class(intersection_195andSchreck5)

disjoint_caroline_5 <- distance5_Caroline_Schrecktime[disjoint_195andSchreck5[[1]],]



#nun die ausserhalb mit 0 und die innerhalb mit 1 ergänzen
disjoint_caroline_5$inField <- 0
inter_sel_5$inField <- 1
#append the two data sets again with their new columns
Caroline_Schreck5_withField <- bind_rows(disjoint_caroline_5,inter_sel_5)



#47 from 2207 Data points are in the field
print(47/2207*100)
# during Schreck time she spends 2 % of her time in the field.

# now the same for before and after
```



## Discussion



