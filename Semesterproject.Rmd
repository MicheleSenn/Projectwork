---
title: Scare-off measures against wild boars 
subtitle: computational movement analysis
author: Lia Baumann and Michele Senn
output: html_document

---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r load wild boar data, include=FALSE}
#install.packages("backports"); install.packages("devtools")
#install.packages("cli")
#update.packages(cli)
#install.packages("devtools") # <- if you havent installed devtools already
library(devtools)
devtools::install_github("ComputationalMovementAnalysis/ComputationalMovementAnalysisData")
library(ComputationalMovementAnalysisData)
head(wildschwein_BE)
summary(wildschwein_BE)
head(schreck_agenda)
summary(schreck_agenda)
head(schreck_locations)
head(wildschwein_metadata)
head(wildschwein_overlap_temp)
```

## Abstract

<!-- the following is just a placeholder text, remove it!-->
Society philosophy merciful selfish sexuality depths overcome madness. Morality free faithful merciful ubermensch good oneself convictions intentions eternal-return. Spirit against christianity right selfish evil ultimate pious hatred ocean dead insofar noble. Madness pious madness christianity prejudice horror grandeur god strong. Ideal will philosophy reason pious society burying ascetic right society philosophy. Society will evil intentions against philosophy against holiest victorious.


## Introduction

<!-- the following is just a placeholder text, remove it!-->
Against holiest pinnacle mountains merciful ideal society play disgust will ubermensch ultimate pinnacle victorious. Snare value law gains battle pious intentions revaluation strong. Insofar snare faith ideal oneself.

```{r packages, include=FALSE}
library(ComputationalMovementAnalysisData)
library(ggplot2)
library(dplyr)
library(sf)

# Include tables with the function "kable"

#knitr::kable(head(wildschwein_BE))
```
```{r temporal overlap}
sampling_periods <- wildschwein_BE %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise(
    min = min(DatetimeUTC),
    max = max(DatetimeUTC)
  )


wildschwein_overlap_temp <- wildschwein_overlap_temp %>%
  left_join(sampling_periods, by = c("TierID", "TierName", "CollarID"))


wildschwein_overlap_temp %>%
mutate(TierCollar = paste(TierName, CollarID)) %>%
  ggplot(aes(xmin = min, xmax = max, y = TierCollar)) +
  geom_errorbarh() +
  facet_grid(Groups~., scales = "free_y", space = "free_y")

```
```{r spatial overlap}
wildschwein_sf <- wildschwein_BE %>%
  st_as_sf(coords = c("E", "N"), crs = 2056) %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) 

wildschwein_convex_hull <- wildschwein_sf %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise() %>%
  st_convex_hull()


wildschwein_convex_hull %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) %>%
  ggplot(aes(fill = factor(TierID))) + geom_sf(alpha = 0.1) +
  coord_sf(datum = 2056) +
  facet_wrap(~tiercollar) +
  theme(legend.position = "none")


st_overlaps(wildschwein_convex_hull, sparse = FALSE)[1:5, 1:5]
```

```{r EDA}
#looking at all data points
ggplot(wildschwein_BE, aes(E,N, colour = TierID)) +
  geom_point() +
  theme(legend.position = "none")

#schreck_locations needs to be transformed into the same coordinate system
schreck_locations_sf <- schreck_locations %>%
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>%
  st_transform(2056)

#plot wildschweins and schrecks together to see their spatial overlap
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf, aes(color=region)) +
  coord_sf(datum=2056)
#Die Tiere sind nur von Schrecks in der Region Fanel beeinträchtigt (kann das sein?)

#alle anderen rausfiltern
schreck_locations_sf_fanel <- schreck_locations_sf %>%
  filter(region=="fanel")

#testen, ob dies stimmt
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf_fanel, aes(color=region)) +
  coord_sf(datum=2056)
```
```{r join schreck agendas fanel}
agenda_fanel <- inner_join(schreck_locations_sf_fanel, schreck_agenda, by="id")

#show when the schrecks in fanel were used
ggplot(agenda_fanel, aes(xmin = datum_on, xmax = datum_off, y=id )) +
  geom_errorbarh()
```
```{r distance to Schreck 1}
#Idee: Nur mal mit einem Schreck beginnen

#1 Schreck rausfiltern
schreck1 <- agenda_fanel[1,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden
wildschwein_schreck1 <- filter(wildschwein_sf,DatetimeUTC>schreck1$datum_on,DatetimeUTC<schreck1$datum_off)

#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck1$distance <- as.numeric(st_distance(wildschwein_schreck1,schreck1)[,1])

ggplot(wildschwein_schreck1, aes(DatetimeUTC, distance)) + geom_point()
#Alle Tiere, welche während der Laufzeit bis zu 2000m nah am Schreck 1 waren, hätten ihn hören können (Entscheidung Lia)

wildschwein_schreck1_close <- wildschwein_schreck1 %>%
  filter(distance < 2000)

ggplot() + geom_sf(data=wildschwein_schreck1_close, aes(color=TierName)) +
  geom_sf(data=schreck1,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck1_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")
```
```{r Ueli only with Schreck1}
#establish baseline distance of Ueli to Schreck1
Ueli_distance <- wildschwein_sf %>%
  filter(TierName == "Ueli")

Ueli_distance$distance <- as.numeric(st_distance(Ueli_distance,schreck1)[,1])

ggplot() + geom_point(data=Ueli_distance,aes(DatetimeUTC,distance)) +
  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))
#Ueli doesn't return to the Schreck1 location until 1.5 years later when he was sampled again
#Zoom in on the timeline:
Ueli_distance_2014 <- Ueli_distance %>%
  filter(lubridate::year(DatetimeUTC) == 2014)
ggplot() + geom_point(data=Ueli_distance_2014,aes(DatetimeUTC,distance)) +
  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))

(Ueli_schreck1_close <- wildschwein_schreck1_close %>%
  dplyr::filter(TierName=="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line())

# Ueli heard the sound for about 2 weeks and started going further away
#plot not only distance of 2000m but more:

Ueli_schreck1 <- wildschwein_schreck1 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck=schreck1$id)

ggplot(Ueli_schreck1, aes(DatetimeUTC,distance)) + geom_line()
# he came back after a while, even almost to 1000 m to the Schreck. But after the sound stopped, he wasn't sampled anymore --> we don't know if he returned in the meantime
```

```{r facet plot of the returning patterns to Schreck 1}
(All_schreck1 <- wildschwein_schreck1_close %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))

(AllButUeli_schreck1 <- wildschwein_schreck1_close %>%
    filter(TierName !="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))
```

```{r distance to Schreck 2}
#Zweiten Schreck modellieren

#2. Schreck rausfiltern
schreck2 <- agenda_fanel[2,]

#Die Wildschweine zwischen dem Start und Ende des zweiten schrecks finden
wildschwein_schreck2 <- filter(wildschwein_sf,DatetimeUTC>schreck2$datum_on,DatetimeUTC<schreck2$datum_off)

#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck2$distance <- as.numeric(st_distance(wildschwein_schreck2,schreck2)[,1])

ggplot(wildschwein_schreck2, aes(DatetimeUTC, distance)) + geom_point()
#Alle Tiere, welche während der Laufzeit bis zu 2000m nah am Schreck 2 waren, hätten ihn hören können (Entscheidung Lia)

wildschwein_schreck2_close <- wildschwein_schreck2 %>%
  filter(distance < 2000)

Ueli_schreck2 <- wildschwein_schreck2 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck = schreck2$id)

ggplot() + geom_sf(data=wildschwein_schreck2_close, aes(color=TierName)) +
  geom_sf(data=schreck2,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck2_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05 (without fence)")

#comparison between Schreck 1 & Schreck 2
ggplot() +
  geom_line(data=Ueli_schreck1, aes(DatetimeUTC,distance)) +
  geom_line(data=Ueli_schreck2, aes(DatetimeUTC,distance)) +
  labs(title="Ueli's distance to concurrently sounding Schrecks")
```

```{r reduction in sampling size concurrent Schrecks 1 + 2}

#use only every 40th observation point to reduce complexity
reduce_Ueli_schreck1 <- Ueli_schreck1 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_Ueli_schreck2 <- Ueli_schreck2 %>% dplyr::filter(row_number() %% 50 == 0)

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

```{r distance to Schreck 1 & 2 all animals except Ueli}
wildschwein_schreck1$Schreck <- schreck1$id
wildschwein_schreck2$Schreck <- schreck2$id

reduce_schreck1 <- wildschwein_schreck1 %>% dplyr::filter(row_number() %% 150 == 0)
reduce_schreck2 <- wildschwein_schreck2 %>% dplyr::filter(row_number() %% 150 == 0)

reduce_schreck1_withoutUeli <- reduce_schreck1 %>%
  filter(TierName != "Ueli")
reduce_schreck2_withoutUeli <- reduce_schreck2 %>%
  filter(TierName != "Ueli")

ggplot(reduce_schreck1_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the other affected boars to Schreck WSS_2014_04")

ggplot(reduce_schreck2_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05")

#Now we'll look at Sabine alone (the others don't show a useful pattern)
reduce_schreck1_Sabine <- reduce_schreck1_withoutUeli %>%
  filter(TierName =="Sabine")
reduce_schreck2_Sabine <- reduce_schreck2_withoutUeli %>%
  filter(TierName =="Sabine")

ggplot(reduce_schreck1_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")

#inspect pattern of the two Schrecks together

ggplot() +
  geom_line(data=reduce_schreck1_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_schreck2_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Sabine's distance to concurrent Schrecks, sampling size reduced")

#They start to move further away, initially, but come back later anyways
```

```{r distance to Schreck 4}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#3. bzw. 4. Schreck rausfiltern
#schreck3 <- agenda_fanel[3,]
schreck4 <- agenda_fanel[4,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
#wildschwein_schreck3 <- #filter(wildschwein_sf,DatetimeUTC>schreck3$datum_on,DatetimeUTC<schreck3$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck4 <- filter(wildschwein_sf,DatetimeUTC>schreck4$datum_on,DatetimeUTC<schreck4$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
#wildschwein_schreck3$distance <- #as.numeric(st_distance(wildschwein_schreck3,schreck3)[,1])
wildschwein_schreck4$distance <- as.numeric(st_distance(wildschwein_schreck4,schreck4)[,1])

wildschwein_schreck4$Schreck <- schreck4$id

ggplot() + geom_sf(data=wildschwein_schreck4, aes(color=TierName)) +
  geom_sf(data=schreck4,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck4, aes(DatetimeUTC,distance, color=Schreck)) + geom_line() + labs(title="Distance of the only affected boar Ueli to Schreck WSS_2014_06 (aggressive)")

reduce_Ueli_schreck4 <- Ueli_schreck4 %>% dplyr::filter(row_number() %% 50 == 0)

#inspect pattern of 3 Schrecks on Ueli

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck4, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

```{r distance to Schreck 5 & 6}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#5. bzw. 6. Schreck rausfiltern
schreck5 <- agenda_fanel[5,]
schreck6 <- agenda_fanel[6,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck5 <- filter(wildschwein_sf,DatetimeUTC>schreck5$datum_on,DatetimeUTC<schreck5$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck6 <- filter(wildschwein_sf,DatetimeUTC>schreck6$datum_on,DatetimeUTC<schreck6$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck5$distance <- as.numeric(st_distance(wildschwein_schreck5,schreck5)[,1])
wildschwein_schreck6$distance <- as.numeric(st_distance(wildschwein_schreck6,schreck6)[,1])

wildschwein_schreck6$Schreck <- schreck6$id
wildschwein_schreck5$Schreck <- schreck5$id

ggplot() + geom_sf(data=wildschwein_schreck5, aes(color=TierName)) +
  geom_sf(data=schreck5,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

reduce_schreck5 <- wildschwein_schreck5 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_schreck6 <- wildschwein_schreck6 %>% dplyr::filter(row_number() %% 50 == 0)

ggplot(reduce_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

ggplot(reduce_schreck6, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (aggressive)")

#Now I'll filter out the boars that are too far away:
reduce_schreck5_close <- reduce_schreck5 %>%
 filter(distance<=1300)

reduce_schreck6_close <- reduce_schreck6 %>%
  filter(TierName != "Franz",
         TierName != "Rosa",
         TierName != "Ruth")

ggplot(reduce_schreck5_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

ggplot() +
  geom_line(data=reduce_schreck5, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  geom_line(data=reduce_schreck6, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Boar's distance to Schrecks changing from standard to aggressive sound, sampling size reduced")

#looking at the close animals
ggplot() +
  geom_line(data=reduce_schreck5_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck6_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Close Boar's distance to Schrecks changing from standard to aggressive mode, sampling size reduced")
#They start to move further away, initially, but come back later anyways
```
```{r comparison of Schrecks 1-6}
#Idea: give IDs to concurrent observations and try to see if the distances follow the same pattern

```


```{r Coaching von Nils}
forest <- read_sf("Feldaufnahmen_Fanel.gpkg")
```

<!-- the following is just a placeholder text, remove it!-->
Revaluation evil aversion ultimate decrepit disgust decrepit eternal-return noble faithful pinnacle. Truth ascetic inexpedient decrepit free. Ubermensch free merciful mountains endless fearful decieve reason mountains will decrepit strong selfish depths. Overcome faith snare gains oneself transvaluation.



## Material and Methods

<!-- the following is just a placeholder text, remove it!-->
Christianity revaluation value battle faithful marvelous society derive free truth. Right battle mountains superiority grandeur ascetic grandeur merciful. Derive against intentions burying salvation ocean. Right intentions dead victorious ideal spirit evil ultimate joy. Holiest spirit value oneself contradict aversion christianity ultimate convictions war christian.

## Results

<!-- the following is just a placeholder text, remove it!-->
Philosophy oneself passion play fearful self noble zarathustra deceptions sexuality. Endless ocean of oneself dead ocean. Selfish decrepit.

## Discussion

<!-- the following is just a placeholder text, remove it!-->
Justice convictions spirit sexuality insofar free marvelous joy. Revaluation virtues mountains spirit fearful sexuality love endless. Society intentions will noble burying aversion moral. Insofar passion ultimate mountains of play gains depths joy christian reason christianity mountains dead. Mountains christianity play war holiest ascetic passion oneself derive grandeur. Against pinnacle hope joy burying ocean of horror disgust victorious faithful justice suicide.

