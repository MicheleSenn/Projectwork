---
title: Scare-off measures against wild boars 
subtitle: computational movement analysis
author: Lia Baumann and Michele Senn
output: html_document

---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r load wild boar data, include=FALSE}
#install.packages("backports"); install.packages("devtools")
#install.packages("cli")
#update.packages(cli)
#install.packages("devtools") # <- if you havent installed devtools already
library(devtools)
devtools::install_github("ComputationalMovementAnalysis/ComputationalMovementAnalysisData")
library(ComputationalMovementAnalysisData)
head(wildschwein_BE)
summary(wildschwein_BE)
head(schreck_agenda)
summary(schreck_agenda)
head(schreck_locations)
head(wildschwein_metadata)
head(wildschwein_overlap_temp)
```

## Abstract

<!-- the following is just a placeholder text, remove it!-->
Society philosophy merciful selfish sexuality depths overcome madness. Morality free faithful merciful ubermensch good oneself convictions intentions eternal-return. Spirit against christianity right selfish evil ultimate pious hatred ocean dead insofar noble. Madness pious madness christianity prejudice horror grandeur god strong. Ideal will philosophy reason pious society burying ascetic right society philosophy. Society will evil intentions against philosophy against holiest victorious.


## Introduction

<!-- the following is just a placeholder text, remove it!-->
Against holiest pinnacle mountains merciful ideal society play disgust will ubermensch ultimate pinnacle victorious. Snare value law gains battle pious intentions revaluation strong. Insofar snare faith ideal oneself.

```{r packages, include=FALSE}
library(ComputationalMovementAnalysisData)
library(ggplot2)
library(dplyr)
library(sf)

# Include tables with the function "kable"

#knitr::kable(head(wildschwein_BE))
```
```{r temporal overlap}
sampling_periods <- wildschwein_BE %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise(
    min = min(DatetimeUTC),
    max = max(DatetimeUTC)
  )


wildschwein_overlap_temp <- wildschwein_overlap_temp %>%
  left_join(sampling_periods, by = c("TierID", "TierName", "CollarID"))


wildschwein_overlap_temp %>%
mutate(TierCollar = paste(TierName, CollarID)) %>%
  ggplot(aes(xmin = min, xmax = max, y = TierCollar)) +
  geom_errorbarh() +
  facet_grid(Groups~., scales = "free_y", space = "free_y")

```
```{r spatial overlap}
wildschwein_sf <- wildschwein_BE %>%
  st_as_sf(coords = c("E", "N"), crs = 2056) %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) 


wildschwein_convex_hull <- wildschwein_sf %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise() %>%
  st_convex_hull()


wildschwein_convex_hull %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) %>%
  ggplot(aes(fill = factor(TierID))) + geom_sf(alpha = 0.1) +
  coord_sf(datum = 2056) +
  facet_wrap(~tiercollar) +
  theme(legend.position = "none")


st_overlaps(wildschwein_convex_hull, sparse = FALSE)[1:5, 1:5]
```

```{r EDA}
#looking at all data points
ggplot(wildschwein_BE, aes(E,N, colour = TierID)) +
  geom_point() +
  theme(legend.position = "none")

#schreck_locations needs to be transformed into the same coordinate system
schreck_locations_sf <- schreck_locations %>%
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>%
  st_transform(2056)

#plot wildschweins and schrecks together to see their spatial overlap
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf, aes(color=region)) +
  coord_sf(datum=2056)
#Die Tiere sind nur von Schrecks in der Region Fanel beeinträchtigt (kann das sein?)

#alle anderen rausfiltern
schreck_locations_sf_fanel <- schreck_locations_sf %>%
  filter(region=="fanel")

#testen, ob dies stimmt
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf_fanel, aes(color=region)) +
  coord_sf(datum=2056)
```
```{r join schreck agendas fanel}
agenda_fanel <- inner_join(schreck_locations_sf_fanel, schreck_agenda, by="id")

#show when the schrecks in fanel were used
ggplot(agenda_fanel, aes(xmin = datum_on, xmax = datum_off, y=id )) +
  geom_errorbarh()
```
```{r temporally close animals}
#Idee: Alle Monate, wo der Schreck lief zusammen joinen mit allen Monaten, wo die Wildschweine getrackt wurden. So können wir schon mal zeitlich sagen, welche überhaupt mit dem Schreck beeinflusst hätten sein können (nur zeitlich)

#Achtung, es fehlen noch einige Monate dazwischen -> herausfinden wie diese zu finden sind!
fanel_months <- agenda_fanel %>%
  mutate(month_start=paste(lubridate::month(datum_on),"-",lubridate::year(datum_on)),
         month_end=paste(lubridate::month(datum_off),"-",lubridate::year(datum_off)),
         N_days=difftime(datum_off,datum_on,tz="UTC")) %>%
  select(id,month_start,month_end) %>%
  tidyr::pivot_longer(2:3,values_to="month_year")
    #da es sich z.T. um mehrere Monate handelt
agenda_fanel_months <- st_join(agenda_fanel,fanel_months,by="id") %>%
  select(-id.y,-name)

#eine gröbere Filtermöglichkeit mit Jahr darstellen
Fanel_years <- agenda_fanel %>%
  mutate(roundToYear = lubridate::year(datum_on))

wildschwein_months_years <- wildschwein_sf %>%
  group_by(TierName,month_year = paste(lubridate::month(DatetimeUTC),"-",
                          lubridate::year(DatetimeUTC)),
           year=lubridate::year(DatetimeUTC)) %>%
  summarize() %>%
  as.data.frame()
   
join_fanel_wildschwein_months <- inner_join(fanel_months,wildschwein_months_years,by = "month_year")  
knitr::kable(join_fanel_wildschwein_months %>%
               group_by(year,TierName) %>%
         summarize(n=n())) #diese Tiere kommen möglicherweise beim Schreck vorbei, während er ON ist.
```
```{r distance to Schreck}
#Idee: mit dem obigen Join kann man nun die Datasets einschränken / wurde nun eingeschränkt.
#Danach muss die Distanz zum jeweiligen Schreck gerechnet und dargestellt werden
```
<!-- the following is just a placeholder text, remove it!-->
Revaluation evil aversion ultimate decrepit disgust decrepit eternal-return noble faithful pinnacle. Truth ascetic inexpedient decrepit free. Ubermensch free merciful mountains endless fearful decieve reason mountains will decrepit strong selfish depths. Overcome faith snare gains oneself transvaluation.



## Material and Methods

<!-- the following is just a placeholder text, remove it!-->
Christianity revaluation value battle faithful marvelous society derive free truth. Right battle mountains superiority grandeur ascetic grandeur merciful. Derive against intentions burying salvation ocean. Right intentions dead victorious ideal spirit evil ultimate joy. Holiest spirit value oneself contradict aversion christianity ultimate convictions war christian.

## Results

<!-- the following is just a placeholder text, remove it!-->
Philosophy oneself passion play fearful self noble zarathustra deceptions sexuality. Endless ocean of oneself dead ocean. Selfish decrepit.

## Discussion

<!-- the following is just a placeholder text, remove it!-->
Justice convictions spirit sexuality insofar free marvelous joy. Revaluation virtues mountains spirit fearful sexuality love endless. Society intentions will noble burying aversion moral. Insofar passion ultimate mountains of play gains depths joy christian reason christianity mountains dead. Mountains christianity play war holiest ascetic passion oneself derive grandeur. Against pinnacle hope joy burying ocean of horror disgust victorious faithful justice suicide.

