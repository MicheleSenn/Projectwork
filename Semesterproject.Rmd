---
title: Scare-off measures against wild boars 
subtitle: computational movement analysis
author: Lia Baumann and Michele Senn
output: html_document

---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r load wild boar data, include=FALSE}
#install.packages("backports"); install.packages("devtools")
#install.packages("cli")
#update.packages(cli)
#install.packages("devtools") # <- if you havent installed devtools already
library(devtools)
devtools::install_github("ComputationalMovementAnalysis/ComputationalMovementAnalysisData")
library(ComputationalMovementAnalysisData)
head(wildschwein_BE)
summary(wildschwein_BE)
head(schreck_agenda)
summary(schreck_agenda)
head(schreck_locations)
head(wildschwein_metadata)
head(wildschwein_overlap_temp)
```

## Abstract

<!-- the following is just a placeholder text, remove it!-->
This project aims at modelling the behavior of wild boars after scare-off measures. It is hypothesized that they will return within a few days back to the scare-off location and this returning pattern will be analysed.


## Research Question

<!-- the following is just a placeholder text, remove it!-->
Once a scare-off measure has proven to have an effect and cause the wild boars to relocate, it needs to be examined how long the effect lasts. Therefore, the following research question was formulated:

How can the returning of the boars be modelled?

##Data

Long-term data for movement trajectories will be necessary (at least 6 weeks).
Data should be of different times of day and of several individuals in a similar location.
Furthermore, mapdata will be needed.
Some background information on the boars social behavior and seasonal movements would also be interesting and help for a better understanding of the data.

##Analytical concepts

EDA: plotting data in order to get an idea of what the data looks like and finding patterns like which individual is Schrecked by what
Calculating distances to Scare-Off-Location over time using the ST_Distance() function, which returns the shortest distance that separates two geometries
Trajectories with Moving Window Method to remove static points
Plot spatial and time overlaps between the tracked animals
Find returning patterns by building a "In the Field / not in the Field" vs. distance to Schreck graph

##R concepts

The modeling will be done using the following concepts and packages:

Spatial objects will be created with the r-package "sf"
raster data and background maps will be plotted and visuallized with these r-packages: "plotly", "ggplot2"
For the reshaping and transforming of date the r-package "tidyverse" will be used

##Risk analysis

We consider the scope a bit of a risk because of the amount of behaviors we could potentially analyse --> we need to be clear on what we really want to find out and stick to it.
Interpretation of behaviors might be vague or non-causal because we assume that patterns can be detected when nothing is happening at all in reality (--> semantic annotations)
Surprisingly, no differences between seasons / locations / individuals detected --> we can still focus on time series analysis
Technical difficulties, e.g. when handling too much data, choosing irrelevant thresholds or interpretation issues.
Possibly, the different measures don't show the same effects. We might need to distinguish between measures in order to draw inferences.

## Results

```{r packages, include=FALSE}
library(ComputationalMovementAnalysisData)
library(ggplot2)
library(dplyr)
library(sf)

# Include tables with the function "kable"

#knitr::kable(head(wildschwein_BE))
```
```{r temporal overlap, eval=FALSE, include=FALSE}
sampling_periods <- wildschwein_BE %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise(
    min = min(DatetimeUTC),
    max = max(DatetimeUTC)
  )


wildschwein_overlap_temp <- wildschwein_overlap_temp %>%
  left_join(sampling_periods, by = c("TierID", "TierName", "CollarID"))


wildschwein_overlap_temp %>%
mutate(TierCollar = paste(TierName, CollarID)) %>%
  ggplot(aes(xmin = min, xmax = max, y = TierCollar)) +
  geom_errorbarh() +
  facet_grid(Groups~., scales = "free_y", space = "free_y")

```
```{r spatial overlap, include=FALSE}
wildschwein_sf <- wildschwein_BE %>%
  st_as_sf(coords = c("E", "N"), crs = 2056) %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) 

wildschwein_convex_hull <- wildschwein_sf %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise() %>%
  st_convex_hull()


wildschwein_convex_hull %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) %>%
  ggplot(aes(fill = factor(TierID))) + geom_sf(alpha = 0.1) +
  coord_sf(datum = 2056) +
  facet_wrap(~tiercollar) +
  theme(legend.position = "none")


st_overlaps(wildschwein_convex_hull, sparse = FALSE)[1:5, 1:5]
```

#Data Preparation
To find out, which boars were affected by which Schreck, the datasets were both transformed into the same coordinate system using st_transform(2056). They were subsequently plotted on top of each other to visualize the spatial overlap.

```{r EDA}
#looking at all data points
#ggplot(wildschwein_BE, aes(E,N, colour = TierID)) +
#  geom_point() +
#  theme(legend.position = "none")

#schreck_locations needs to be transformed into the same coordinate system
schreck_locations_sf <- schreck_locations %>%
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>%
  st_transform(2056)

#plot wildschweins and schrecks together to see their spatial overlap
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf, aes(color=region)) +
  coord_sf(datum=2056)
#Die Tiere sind nur von Schrecks in der Region Fanel beeinträchtigt (kann das sein?)
```
As a result, it was found that the animals were only tracked around the Schreck in the region of Fanel. As a consequence, all other Schreck data points were removed and the spatial overlap replotted.

```{r filter all but region Fanel}
#alle anderen rausfiltern
schreck_locations_sf_fanel <- schreck_locations_sf %>%
  filter(region=="fanel")

#testen, ob dies stimmt
ggplot() +
  geom_sf(data=wildschwein_sf,aes(fill=TierID)) +
  geom_sf(data=schreck_locations_sf_fanel, aes(color=region)) +
  coord_sf(datum=2056)
```


In order to combine the data about the Schreck locations and their corresponding agenda, or sounding time, they were joined by their matching column "id" with an inner join.
Following this join, the agenda of all the "Schreck time" was visualized using an errorbar plot.

```{r join schreck agendas fanel}
agenda_fanel <- inner_join(schreck_locations_sf_fanel, schreck_agenda, by="id")

#show when the schrecks in fanel were used
ggplot(agenda_fanel, aes(xmin = datum_on, xmax = datum_off, y=id )) +
  geom_errorbarh()
```

# Schreck 1
In order to see which animals were tracked during the active period of the "Schreck", the boar data was filtered by the dates in which the Schreck were active.
For the tracked boars, a distance between their coordinates and the Schreck coordinate was calculated using st_distance().

To single out the boars which could have been affected by the Schreck, all boars wo never came into the radius of the "minimal Ausrichtung" of the Schreck were removed. The remaining distances were plotted against the DatetimeUTC column.


```{r distance to Schreck 1}
#1 Schreck rausfiltern
schreck1 <- agenda_fanel[1,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck1 <- filter(wildschwein_sf,DatetimeUTC>schreck1$datum_on,DatetimeUTC<schreck1$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck1$distance <- as.numeric(st_distance(wildschwein_schreck1,schreck1)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck1_close <- wildschwein_schreck1 %>%
  filter(distance < 200)

#ggplot

ggplot(wildschwein_schreck1_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")
```
Only these two boars were close enough to Schreck WSS_2014_04 during the time of the Schreck running to potentially have been affected.

```{r distance to Schreck 1}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance <- as.numeric(st_distance(wildschwein_sf,schreck1)[,1])

#Kandidaten rausfiltern
affected_distance <- wildschwein_sf %>%
  filter(TierName == c("Sabine","Isabelle"),DatetimeUTC > "2014-04-01 21:01:14", DatetimeUTC < "2014-12-28 21:01:14")

#ggplot
ggplot(affected_distance, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_04")
```
Sabine and Isabelle don't seem to be impressed by the Schreck. However they only just came across the Schreck for 2 and 4 days accordingly before the Schreck stopped.

#Schreck 2

```{r distance to Schreck 2}
# Schreck rausfiltern
schreck2 <- agenda_fanel[2,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck2$datum_on,DatetimeUTC<schreck2$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck2)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[2])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_05")
```
Not enough exposure of the boars to Schreck 2.

#Schreck 3

```{r distance to Schreck}
# Schreck rausfiltern
schreck3 <- agenda_fanel[3,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck3$datum_on,DatetimeUTC<schreck3$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck2)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[3])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_06")
```
Not enough exposure of the boars to Schreck 3.

#Schreck 4

```{r distance to Schreck 4}
# Schreck rausfiltern
schreck2 <- agenda_fanel[4,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck4$datum_on,DatetimeUTC<schreck4$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck4)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[4])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2014_06")
```
Not enough exposure of the boars to Schreck 4.

#Schreck 5

```{r distance to Schreck 5}
# Schreck rausfiltern
schreck5 <- agenda_fanel[5,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck5$datum_on,DatetimeUTC<schreck5$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck5)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[5])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Four boars had exposure to Schreck 5.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance <- as.numeric(st_distance(wildschwein_sf,schreck5)[,1])

#Kandidaten rausfiltern
affected_distance <- wildschwein_sf %>%
  filter(TierName == c("Caroline","Claude","Olga","Sabine"), DatetimeUTC > "2015-05-20 21:01:14",DatetimeUTC < "2015-06-12 21:01:14")

#ggplot
ggplot(affected_distance, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Schreck 5 was running from 2015-05-20 to 2015-06-12. It looks as if in the beginning the boars kept a distance of half a kilometer, but came back all the same after about a month.

#Schreck 6

```{r distance to Schreck 6}
# Schreck rausfiltern
schreck6 <- agenda_fanel[6,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck6$datum_on,DatetimeUTC<schreck6$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck6)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[6])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```

Three boars had exposure to Schreck 6.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance <- as.numeric(st_distance(wildschwein_sf,schreck6)[,1])

#Kandidaten rausfiltern
affected_distance <- wildschwein_sf %>%
  filter(TierName == c("Caroline","Olga","Sabine"), DatetimeUTC > "2015-05-01 21:01:14",DatetimeUTC < "2015-08-12 21:01:14")

#ggplot
ggplot(affected_distance, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_01")
```
Schreck 6 was running from 2015-06-12 to 2015-07-01 and seems to have no effect.

#Schreck 7

```{r distance to Schreck 7}
# Schreck rausfiltern
schreck7 <- agenda_fanel[7,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck7$datum_on,DatetimeUTC<schreck7$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck7)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[7])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_03")
```

Only one boar was affected.


#Schreck 8

```{r distance to Schreck 8}
# Schreck rausfiltern
schreck8 <- agenda_fanel[8,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck8$datum_on,DatetimeUTC<schreck8$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck8)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[8])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_03")
```
Only one boar was affected.


#Schreck 9

```{r distance to Schreck 9}
# Schreck rausfiltern
schreck9 <- agenda_fanel[9,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck9$datum_on,DatetimeUTC<schreck9$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck9)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[9])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_04")
```
Only one boar was affected.


#Schreck 10

```{r distance to Schreck 10}
# Schreck rausfiltern
schreck10 <- agenda_fanel[10,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck10$datum_on,DatetimeUTC<schreck10$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck10)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[10])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2015_04")
```
Only one boar was affected.


#Schreck 11

```{r distance to Schreck 11}
# Schreck rausfiltern
schreck11 <- agenda_fanel[11,]

#Die Wildschweine zwischen dem Start und Ende des ersten schrecks finden

wildschwein_schreck <- filter(wildschwein_sf,DatetimeUTC>schreck11$datum_on,DatetimeUTC<schreck11$datum_off)


#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck$distance <- as.numeric(st_distance(wildschwein_schreck,schreck11)[,1])

#Alle Tiere, welche während der Laufzeit bis zu 200m nah am Schreck 1 waren, hätten ihn hören können 

wildschwein_schreck_close <- wildschwein_schreck %>%
  filter(distance < agenda_fanel$ausrichtung_min[11])

#ggplot

ggplot(wildschwein_schreck_close, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2016_01")
```
Frida and Miriam were affected by the Schreck.

```{r distance to Schreck}

#Distanz zwischen dem Schreck und den wildschweinen
#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_sf$distance <- as.numeric(st_distance(wildschwein_sf,schreck11)[,1])

#Kandidaten rausfiltern
affected_distance <- wildschwein_sf %>%
  filter(TierName == c("Frida","Miriam"), DatetimeUTC > "2016-03-01 21:01:14",DatetimeUTC < "2016-05-12 21:01:14")

#ggplot
ggplot(affected_distance, aes(DatetimeUTC,distance, color=TierName)) + geom_point() + labs(title="Distance of the affected boars to Schreck WSS_2016_01")
```

Schreck 11 was running from 2016-04-04 to 2016-04-23. It looks like Frida moved away after the Schreck started, whereas Miriam was unimpressed by it.

#Step 4
Ueli looks like an interesting candidate for further inspection.
His corresponding location data to "Schreck time 1" were filtered and visualized in different ways.

```{r Ueli only with Schreck1}
#establish baseline distance of Ueli to Schreck1
Ueli_distance <- wildschwein_sf %>%
  filter(TierName == "Ueli")

Ueli_distance$distance <- as.numeric(st_distance(Ueli_distance,schreck1)[,1])

Ueli_schreck1 <- wildschwein_schreck1 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck=schreck1$id)

#ggplot() + geom_point(data=Ueli_distance,aes(DatetimeUTC,distance)) +
#  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))
#Ueli doesn't return to the Schreck1 location until 1.5 years later when he was sampled again
#Zoom in on the timeline:
Ueli_distance_2014 <- Ueli_distance %>%
  filter(lubridate::year(DatetimeUTC) == 2014)
ggplot() + geom_point(data=Ueli_distance_2014,aes(DatetimeUTC,distance)) +
  geom_point(data=Ueli_schreck1,aes(DatetimeUTC,distance, color="red"))

(Ueli_schreck1_close <- wildschwein_schreck1_close %>%
  dplyr::filter(TierName=="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line())

# Ueli heard the sound for about 2 weeks and started going further away
#plot not only distance of 2000m but more:

ggplot(Ueli_schreck1, aes(DatetimeUTC,distance)) + geom_line()
# he came back after a while, even almost to 1000 m to the Schreck. But after the sound stopped, he wasn't sampled anymore --> we don't know if he returned in the meantime
```
Same thing with Isabelle and Sabine who should have been near enough to hear the schreck

```{r Sabine and Isabell only with Schreck1}
#establish baseline distance of Sabine and Isabelle to Schreck1
Isabelle_distance <- wildschwein_sf %>%
  filter(TierName == c("Sabine","Isabelle"))

SabineIsablle_distance$distance <- as.numeric(st_distance(SabineIsabelle_distance,schreck1)[,1])

#!!!!!!!!!Warum zeigt es das Datum nicht richtig an? Theoretisch sollte dies die gesamte Trackingzeit plotten. und wie es aussieht waren sie die ganze Zeit nie weiter als 200 m von Schreck 1 entfernt. Wenn das stimmt, waren sie von Schreck 1 komplett unbeeindruckt. Aber von deiner GRafik her weiss ich ja dass das nicht stimmt. Findest du den Fehler?
ggplot(SabineIsablle_distance, aes(DatetimeUTC,distance)) + geom_line()

```

#Step 5
The other animals around Schreck 1 seemed to move in a different way. In order to see more of it, a facet grid was created.
To increase resolution and to show only the concurrently affected boars, Ueli was filtered out in a second facet grid visualization.

```{r facet plot of the returning patterns to Schreck 1}
(All_schreck1 <- wildschwein_schreck1_close_long%>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))

(AllButUeli_schreck1 <- wildschwein_schreck1_close_long%>%
    filter(TierName !="Ueli") %>%
  ggplot(aes(DatetimeUTC,distance)) + geom_line()) + facet_grid(rows=vars(TierName))
```

#Step 6
Now, looking at the distances of Schreck 1 was interesting. Since we are trying to find general patterns (if possible) and later want to look at the returning patterns, all other Schrecks are about to be visualized in a similar fashion.

```{r distance to Schreck 2}
#Zweiten Schreck modellieren

#2. Schreck rausfiltern
schreck2 <- agenda_fanel[2,]

#Die Wildschweine zwischen dem Start und Ende des zweiten schrecks finden
wildschwein_schreck2 <- filter(wildschwein_sf,DatetimeUTC>schreck2$datum_on,DatetimeUTC<schreck2$datum_off)

#Distanz zwischen dem Schreck und den wildschweinen
#st_distance(wildschwein_schreck1,schreck1)[,1]
#rechnet geometrische Punkte selbst aus statt über euclidean distance

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck2$distance <- as.numeric(st_distance(wildschwein_schreck2,schreck2)[,1])

ggplot(wildschwein_schreck2, aes(DatetimeUTC, distance)) + geom_point()
#Alle Tiere, welche während der Laufzeit bis zu 2000m nah am Schreck 2 waren, hätten ihn hören können (Entscheidung Lia)

wildschwein_schreck2_close <- wildschwein_schreck2 %>%
  filter(distance < 2000)

Ueli_schreck2 <- wildschwein_schreck2 %>%
  dplyr::filter(TierName=="Ueli") %>%
  mutate(Schreck = schreck2$id)

ggplot() + geom_sf(data=wildschwein_schreck2_close, aes(color=TierName)) +
  geom_sf(data=schreck2,aes(fill=id)) + coord_sf(datum=2056)

#ggplot(wildschwein_schreck2_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05 (without fence)")

#comparison between Schreck 1 & Schreck 2
ggplot() +
  geom_line(data=Ueli_schreck1, aes(DatetimeUTC,distance)) +
  geom_line(data=Ueli_schreck2, aes(DatetimeUTC,distance)) +
  labs(title="Ueli's distance to concurrently sounding Schrecks")
```

# Step 7
As a measure to reduce data point density, only every 50th observation was used. The loss in data granularity has an effect for readability and observability of a general movement trend, and it doesn't seem that a lot of the information is lost on the way.

In the following graph, distances from Ueli to the two first Schrecks are visualized with a much lower resolution.

```{r reduction in sampling size concurrent Schrecks 1 + 2}

#use only every 50th observation point to reduce complexity
reduce_Ueli_schreck1 <- Ueli_schreck1 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_Ueli_schreck2 <- Ueli_schreck2 %>% dplyr::filter(row_number() %% 50 == 0)

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

#Step 8
A similar approach was used for the other boars affected by Schreck 1 and 2, but even reducing their data points to every 150th.


```{r distance to Schreck 1 & 2 all animals except Ueli}
wildschwein_schreck1$Schreck <- schreck1$id
wildschwein_schreck2$Schreck <- schreck2$id

reduce_schreck1 <- wildschwein_schreck1 %>% dplyr::filter(row_number() %% 150 == 0)
reduce_schreck2 <- wildschwein_schreck2 %>% dplyr::filter(row_number() %% 150 == 0)

reduce_schreck1_withoutUeli <- reduce_schreck1 %>%
  filter(TierName != "Ueli")
reduce_schreck2_withoutUeli <- reduce_schreck2 %>%
  filter(TierName != "Ueli")

ggplot(reduce_schreck1_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the other affected boars to Schreck WSS_2014_04")

ggplot(reduce_schreck2_withoutUeli, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2014_05")
```
Only Sabine seems to have an interesting pattern or was close enough to be affected so here is Sabine's distance to the first 2 Schrecks:

```{r Sabine against Schreck 1,2}
#Now we'll look at Sabine alone (the others don't show a useful pattern)
reduce_schreck1_Sabine <- reduce_schreck1_withoutUeli %>%
  filter(TierName =="Sabine")
reduce_schreck2_Sabine <- reduce_schreck2_withoutUeli %>%
  filter(TierName =="Sabine")

#inspect pattern of the two Schrecks together
ggplot() +
  geom_line(data=reduce_schreck1_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_schreck2_Sabine, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Sabine's distance to concurrent Schrecks, sampling size reduced")

#They start to move further away, initially, but come back later anyways
```

# Step 9
No animal was around at the "Schreck time" of Schreck 3 so it will be omitted for further analyses.
Schreck 4 could only affect our friend Ueli so he will be analysed on his own.
Apparently, this Schreck was active almost at the same time as Schreck 1 and 2, so all distances to the 3 Schrecks were visualized together for Ueli.
It's almost eerie how similar his distancing behavior looks...

```{r distance to Schreck 4}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#3. bzw. 4. Schreck rausfiltern
#schreck3 <- agenda_fanel[3,]
schreck4 <- agenda_fanel[4,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
#wildschwein_schreck3 <- #filter(wildschwein_sf,DatetimeUTC>schreck3$datum_on,DatetimeUTC<schreck3$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck4 <- filter(wildschwein_sf,DatetimeUTC>schreck4$datum_on,DatetimeUTC<schreck4$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
#wildschwein_schreck3$distance <- #as.numeric(st_distance(wildschwein_schreck3,schreck3)[,1])
wildschwein_schreck4$distance <- as.numeric(st_distance(wildschwein_schreck4,schreck4)[,1])

wildschwein_schreck4$Schreck <- schreck4$id

ggplot() + geom_sf(data=wildschwein_schreck4, aes(color=TierName)) +
  geom_sf(data=schreck4,aes(fill=id)) + coord_sf(datum=2056)

ggplot(wildschwein_schreck4, aes(DatetimeUTC,distance, color=Schreck)) + geom_line() + labs(title="Distance of the only affected boar Ueli to Schreck WSS_2014_06 (aggressive)")

reduce_Ueli_schreck4 <- wildschwein_schreck4 %>% dplyr::filter(row_number() %% 50 == 0)

#inspect pattern of 3 Schrecks on Ueli

ggplot() +
  geom_line(data=reduce_Ueli_schreck1, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck2, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  geom_line(data=reduce_Ueli_schreck4, aes(DatetimeUTC,distance, colour=Schreck), linetype="twodash") +
  labs(title="Ueli's distance to concurrently sounding Schrecks, sampling size reduced")
```

#Step 10
Schreck 5 and 6 are the same but move from standard to aggressive mode.
Their distances were visualized with the close animals (ca. <1300m) and only every 50th observation was plotted.
The change in mode was visualized using a different line style.

```{r distance to Schreck 5 & 6}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#5. bzw. 6. Schreck rausfiltern
schreck5 <- agenda_fanel[5,]
schreck6 <- agenda_fanel[6,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck5 <- filter(wildschwein_sf,DatetimeUTC>schreck5$datum_on,DatetimeUTC<schreck5$datum_off)
#Es war kein Tier vom Schreck 3 betroffen...(?)
#rm(wildschwein_schreck3)

wildschwein_schreck6 <- filter(wildschwein_sf,DatetimeUTC>schreck6$datum_on,DatetimeUTC<schreck6$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck5$distance <- as.numeric(st_distance(wildschwein_schreck5,schreck5)[,1])
wildschwein_schreck6$distance <- as.numeric(st_distance(wildschwein_schreck6,schreck6)[,1])

wildschwein_schreck6$Schreck <- schreck6$id
wildschwein_schreck5$Schreck <- schreck5$id

#ggplot() + geom_sf(data=wildschwein_schreck5, aes(color=TierName)) +
#  geom_sf(data=schreck5,aes(fill=id)) + coord_sf(datum=2056)

#ggplot(wildschwein_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

reduce_schreck5 <- wildschwein_schreck5 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_schreck6 <- wildschwein_schreck6 %>% dplyr::filter(row_number() %% 50 == 0)

#ggplot(reduce_schreck5, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

#ggplot(reduce_schreck6, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (aggressive)")

#Now I'll filter out the boars that are too far away:
reduce_schreck5_close <- reduce_schreck5 %>%
 filter(distance<=1300)

reduce_schreck6_close <- reduce_schreck6 %>%
  filter(TierName != "Franz",
         TierName != "Rosa",
         TierName != "Ruth")

#ggplot(reduce_schreck5_close, aes(DatetimeUTC,distance, color=TierName)) + geom_line() + labs(title="Distance of the affected boars to Schreck WSS_2015_01 (standard)")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

#ggplot() +
#  geom_line(data=reduce_schreck5, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
#  geom_line(data=reduce_schreck6, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
 # labs(title="Boar's distance to Schrecks changing from standard to aggressive sound, sampling size reduced")

#looking at the close animals
ggplot() +
  geom_line(data=reduce_schreck5_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck6_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Close Boar's distance to Schrecks changing from standard to aggressive mode, sampling size reduced")
#They start to move further away, initially, but come back later anyways
```
#Step 11
A similar thing was done with Schreck 7 & 8, and only Ruth was close enough to possibly hear the Schreck sound (<1500m).

```{r distance to Schreck 7 & 8}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

#5. bzw. 6. Schreck rausfiltern
schreck7 <- agenda_fanel[7,]
schreck8 <- agenda_fanel[8,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck7 <- filter(wildschwein_sf,DatetimeUTC>schreck7$datum_on,DatetimeUTC<schreck7$datum_off)

wildschwein_schreck8 <- filter(wildschwein_sf,DatetimeUTC>schreck8$datum_on,DatetimeUTC<schreck8$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck7$distance <- as.numeric(st_distance(wildschwein_schreck7,schreck7)[,1])
wildschwein_schreck8$distance <- as.numeric(st_distance(wildschwein_schreck8,schreck8)[,1])

wildschwein_schreck7$Schreck <- schreck7$id
wildschwein_schreck8$Schreck <- schreck8$id

#ggplot() + geom_sf(data=wildschwein_schreck7, aes(color=TierName)) +
#  geom_sf(data=schreck7,aes(fill=id)) + coord_sf(datum=2056)

reduce_schreck7 <- wildschwein_schreck7 %>% dplyr::filter(row_number() %% 50 == 0)
reduce_schreck8 <- wildschwein_schreck8 %>% dplyr::filter(row_number() %% 50 == 0)

#ggplot() + geom_line(data=reduce_schreck7, aes(DatetimeUTC,distance, color=TierName)) +
#  geom_line(data=reduce_schreck8, aes(DatetimeUTC,distance, color=TierName)) +
#  labs(title="Distance of the affected boars to Schreck WSS_2015_03 (standard & aggressive)")

#Now I'll filter out the boars that are too far away:
reduce_schreck7_close <- reduce_schreck7 %>%
  filter(TierName == "Ruth")
reduce_schreck8_close <- reduce_schreck8 %>%
  filter(TierName == "Ruth")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

ggplot() +
  geom_line(data=reduce_schreck7_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck8_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Ruth's distance to Schreck WSS_2015_03 changing from standard to aggressive mode, sampling size reduced")
#sometimes she stays away a bit more but even the aggressive sound doesn't help much
```

#Step 12


```{r distance to Schreck 9 & 10}
#Nächste Schrecks mit verschiedenen Lautstärken anschauen

# Schreck rausfiltern
schreck9 <- agenda_fanel[9,]
schreck10 <- agenda_fanel[10,]

#Die Wildschweine zwischen dem Start und Ende der entsprechenden schrecks finden
wildschwein_schreck9 <- filter(wildschwein_sf,DatetimeUTC>schreck9$datum_on,DatetimeUTC<schreck9$datum_off)

wildschwein_schreck10 <- filter(wildschwein_sf,DatetimeUTC>schreck10$datum_on,DatetimeUTC<schreck10$datum_off)

#Distanz als zusätzliche Spalte hinzusetzen
wildschwein_schreck9$distance <- as.numeric(st_distance(wildschwein_schreck9,schreck9)[,1])
wildschwein_schreck10$distance <- as.numeric(st_distance(wildschwein_schreck10,schreck10)[,1])

wildschwein_schreck9$Schreck <- schreck9$id
wildschwein_schreck10$Schreck <- schreck10$id

#ggplot() + geom_sf(data=wildschwein_schreck9, aes(color=TierName)) +
  geom_sf(data=schreck9,aes(fill=id)) + coord_sf(datum=2056)

reduce_schreck9 <- wildschwein_schreck9 %>% dplyr::filter(row_number() %% 150 == 0)
reduce_schreck10 <- wildschwein_schreck10 %>% dplyr::filter(row_number() %% 150 == 0)

reduce_schreck9_close <- wildschwein_schreck9 %>%
  filter(distance < 2700)
reduce_schreck10_close <- wildschwein_schreck10 %>%
  filter(distance < 2700)

#ggplot() + geom_line(data=reduce_schreck9_close, aes(DatetimeUTC,distance, color=TierName)) +
#  labs(title="Distance of the affected boars to Schreck WSS_2015_04 (standard)")

#ggplot() + geom_line(data=reduce_schreck10_close, aes(DatetimeUTC,distance, color=TierName)) + labs(title="Distance of the affected boars to Schreck WSS_2015_04 (louder)")

#inspect pattern of the two Schrecks together (after each other) to see what happens
#when the sound changes from standard to aggressive

ggplot() +
  geom_line(data=reduce_schreck9_close, aes(DatetimeUTC,distance, colour=TierName)) +
  geom_line(data=reduce_schreck10_close, aes(DatetimeUTC,distance, colour=TierName), linetype="twodash") +
  labs(title="Ruth's distance to Schreck WSS_2015_03 changing from standard to aggressive mode, sampling size reduced")
#sometimes she stays away a bit more but even the aggressive sound doesn't help much
```

```{r comparison of Schrecks that have a different time scale}
#no idea yet
```


```{r Coaching von Nils}
forest <- read_sf("Feldaufnahmen_Fanel.gpkg")
```




## Discussion



